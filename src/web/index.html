<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ— çº¿éº¦å…‹é£</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/inter-ui/inter.css">
    <style>
        :root {
            /* ===== ç³»ç»Ÿå‚æ•° ===== */
            --radius: 0.5rem;
            --font-sans: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-serif: "Newsreader", serif;
            --font-mono: "Geist Mono", monospace;

            /* ===== é˜´å½±ç»†èŠ‚ ===== */
            --shadow-beautiful-lg: 0 2.8px 2.2px rgba(0, 0, 0, .034), 0 6.7px 5.3px rgba(0, 0, 0, .048), 0 12.5px 10px rgba(0, 0, 0, .06), 0 22.3px 17.9px rgba(0, 0, 0, .072), 0 41.8px 33.4px rgba(0, 0, 0, .086), 0 100px 80px rgba(0, 0, 0, .12);
            
            --ring: 221.2 83.2% 53.3%;
        }

        /* æµ…è‰²æ¨¡å¼å˜é‡ */
        :root, .light-mode {
            --background: hsl(0, 0%, 100%);
            --foreground: hsl(0, 0%, 9%);
            
            --card: hsl(0, 0%, 100%);
            --sub-card: hsla(0, 2%, 37%, 0.075);
            --card-foreground: hsl(0, 0%, 9%);
            
            --popover: hsl(0, 0%, 100%);
            --popover-foreground: hsl(0, 0%, 9%);
            
            --primary: hsl(0, 0%, 9%);
            --primary-foreground: hsl(0, 0%, 98%);
            
            --secondary: hsl(0, 0%, 96.1%);
            --secondary-foreground: hsl(0, 0%, 9%);
            
            --muted: hsl(0, 0%, 96.1%);
            --muted-foreground: hsl(0, 0%, 45.1%);
            
            --accent: hsl(0, 0%, 96.1%);
            --accent-foreground: hsl(0, 0%, 9%);
            
            --destructive: hsl(0, 84.2%, 60.2%);
            --destructive-foreground: hsl(0, 0%, 98%);

            --border: hsl(0, 0%, 89.8%);
            --input: hsl(0, 0%, 89.8%);
        }

        /* æ·±è‰²æ¨¡å¼å˜é‡ */
        @media (prefers-color-scheme: dark) {
            :root:not(.light-mode) {
                --background: hsl(0, 0%, 9%);
                --foreground: hsl(0, 0%, 98%);
                
                --card: hsl(0, 0%, 9%);
                --sub-card: hsla(0, 2%, 37%, 0.075);
                --card-foreground: hsl(0, 0%, 98%);
                
                --popover: hsl(0, 0%, 9%);
                --popover-foreground: hsl(0, 0%, 98%);
                
                --primary: hsl(0, 0%, 98%);
                --primary-foreground: hsl(0, 0%, 9%);
                
                --secondary: hsl(0, 0%, 14.9%);
                --secondary-foreground: hsl(0, 0%, 98%);
                
                --muted: hsl(0, 0%, 14.9%);
                --muted-foreground: hsl(0, 0%, 63.9%);
                
                --accent: hsl(0, 0%, 14.9%);
                --accent-foreground: hsl(0, 0%, 98%);
                
                --destructive: hsl(0, 62.8%, 30.6%);
                --destructive-foreground: hsl(0, 0%, 98%);
                
                --border: hsl(0, 0%, 20%);
                --input: hsl(0, 0%, 14.9%);
            }
        }

        /* å¼ºåˆ¶æ·±è‰²æ¨¡å¼ç±» */
        .dark-mode {
            --background: hsl(0, 0%, 9%);
            --foreground: hsl(0, 0%, 98%);
            
            --card: hsl(0, 0%, 9%);
            --sub-card: hsla(0, 2%, 37%, 0.075);
            --card-foreground: hsl(0, 0%, 98%);
            
            --popover: hsl(0, 0%, 9%);
            --popover-foreground: hsl(0, 0%, 98%);
            
            --primary: hsl(0, 0%, 98%);
            --primary-foreground: hsl(0, 0%, 9%);
            
            --secondary: hsla(226, 47%, 30%, 0.884);
            --secondary-foreground: hsl(0, 0%, 98%);
            
            --muted: hsl(0, 0%, 14.9%);
            --muted-foreground: hsl(0, 0%, 63.9%);
            
            --accent: hsl(0, 0%, 14.9%);
            --accent-foreground: hsl(0, 0%, 98%);
            
            --destructive: hsl(0, 62.8%, 30.6%);
            --destructive-foreground: hsl(0, 0%, 98%);
            
            --border: hsl(0, 0%, 20%);
            --input: hsl(0, 0%, 14.9%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            border-color: var(--border);
        }
        
        body {
            font-family: var(--font-sans);
            font-feature-settings: "salt", "ss01", "ss02", "rlig" 1, "calt" 1;
            background-color: var(--background);
            color: var(--foreground);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .container {
            background-color: var(--card);
            border-radius: 1rem;
            padding: 40px 30px;
            box-shadow: var(--shadow-beautiful-lg);
            max-width: 440px;
            width: 100%;
            text-align: center;
            border: 1px solid var(--border);
            animation: fade-in 0.6s ease-out;
            position: relative;
        }

        /* æ¨¡å¼åˆ‡æ¢å¼€å…³ */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background-color: var(--secondary);
            color: var(--foreground);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s;
            z-index: 10;
        }

        .theme-toggle:hover {
            background-color: var(--accent);
            transform: scale(1.1);
        }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h1 {
            color: var(--foreground);
            margin-bottom: 8px;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.05em;
        }
        
        .subtitle {
            color: var(--muted-foreground);
            margin-bottom: 24px;
            font-size: 14px;
            font-weight: 400;
        }
        
        .status {
            padding: 10px 16px;
            border-radius: 9999px;
            margin-bottom: 24px;
            font-weight: 600;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
        }
        
        .status.disconnected {
            background-color: var(--secondary);
            color: var(--muted-foreground);
            border-color: var(--border);
        }
        
        .status.connected {
            background-color: hsla(142, 70%, 45%, 0.1);
            color: #10b981;
            border-color: hsla(142, 70%, 45%, 0.2);
        }
        
        .status.recording {
            background-color: hsla(0, 84%, 60%, 0.1);
            color: var(--destructive);
            border-color: hsla(0, 84%, 60%, 0.2);
            animation: pulse-ring 2s infinite;
        }

        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 hsla(0, 84%, 60%, 0.4); }
            70% { box-shadow: 0 0 0 10px hsla(0, 84%, 60%, 0); }
            100% { box-shadow: 0 0 0 0 hsla(0, 84%, 60%, 0); }
        }
        
        /* æ ‡ç­¾é¡µå¯¼èˆª */
        .tab-nav {
            display: flex;
            margin-bottom: 24px;
            padding: 4px;
            border-radius: 0.75rem;
            background-color: var(--secondary);
            border: 1px solid var(--border);
        }
        
        .tab-btn {
            flex: 1;
            padding: 10px 12px;
            border: none;
            border-radius: 0.5rem;
            background: transparent;
            color: var(--muted-foreground);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .tab-btn.active {
            background-color: var(--card);
            color: var(--foreground);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        
        .info {
            color: var(--muted-foreground);
            font-size: 12px;
            margin-top: 24px;
            line-height: 1.6;
            font-weight: 500;
        }
        
        .volume-meter {
            width: 100%;
            height: 4px;
            background-color: var(--secondary);
            border-radius: 2px;
            overflow: hidden;
            margin: 24px 0;
        }
        
        .volume-bar {
            height: 100%;
            background-color: var(--foreground);
            width: 0%;
            transition: width 0.1s ease;
            box-shadow: 0 0 8px hsla(var(--foreground), 0.3);
        }
        
        .error {
            background-color: hsla(0, 84%, 60%, 0.1);
            color: var(--destructive);
            padding: 12px 16px;
            border-radius: 0.5rem;
            margin-top: 24px;
            font-size: 13px;
            font-weight: 600;
            border: 1px solid hsla(0, 84%, 60%, 0.2);
            display: none;
        }
        
        /* è¿œç¨‹å½•åˆ¶æ§åˆ¶åŒºåŸŸ */
        .record-control {
            background-color: var(--sub-card);
            border-radius: 0.75rem;
            padding: 16px;
            margin: 24px 0;
            border: 1px solid var(--border);
        }
        
        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .record-label {
            font-size: 13px;
            font-weight: 700;
            color: var(--foreground);
            letter-spacing: -0.01em;
        }
        
        .record-status {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 9999px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .record-status.idle {
            background-color: var(--secondary);
            color: var(--muted-foreground);
        }
        
        .record-status.recording {
            background-color: hsla(0, 84%, 60%, 0.1);
            color: var(--destructive);
            border: 1px solid hsla(0, 84%, 60%, 0.2);
        }
        
        .record-button {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .record-button.start {
            background-color: var(--primary);
            color: var(--primary-foreground);
        }
        
        .record-button.start:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .record-button.stop {
            background-color: var(--destructive);
            color: var(--destructive-foreground);
            border-color: var(--destructive);
        }
        
        .record-button.stop:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .record-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .record-button .icon {
            font-size: 18px;
        }
        
        .record-timer {
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            color: var(--destructive);
            margin-top: 12px;
            font-family: var(--font-mono);
            display: none;
            letter-spacing: 0.05em;
        }
        
        .record-timer.active {
            display: block;
        }
        
        .record-hint {
            font-size: 11px;
            color: var(--muted-foreground);
            text-align: center;
            margin-top: 8px;
            font-weight: 500;
        }
        
        /* è´¨é‡æ§åˆ¶åŒºåŸŸ */
        .quality-control {
            background-color: var(--sub-card);
            border-radius: 0.75rem;
            padding: 16px;
            margin: 24px 0;
            border: 1px solid var(--border);
        }
        
        .quality-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .quality-label {
            font-size: 13px;
            font-weight: 700;
            color: var(--foreground);
        }
        
        .quality-value {
            font-size: 12px;
            font-weight: 700;
            color: hsl(var(--ring));
            background-color: hsla(var(--ring), 0.1);
            padding: 2px 8px;
            border-radius: 4px;
        }
        
        .quality-presets {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }
        
        .preset-btn {
            flex: 1;
            margin: 0 3px;
            padding: 8px 4px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background-color: var(--secondary);
            color: var(--muted-foreground);
        }
        
        .preset-btn:hover {
            background-color: var(--accent);
            color: var(--accent-foreground);
        }
        
        .preset-btn.active {
            background-color: var(--primary);
            color: var(--primary-foreground);
            border-color: var(--primary);
        }
        
        .quality-desc {
            font-size: 11px;
            color: var(--muted-foreground);
            margin-top: 12px;
            font-weight: 500;
        }
        
        /* éŸ³é‡æ§åˆ¶åŒºåŸŸ */
        .volume-control {
            background-color: var(--sub-card);
            border-radius: 0.75rem;
            padding: 16px;
            margin: 24px 0;
            border: 1px solid var(--border);
        }
        
        .volume-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .volume-label {
            font-size: 13px;
            font-weight: 700;
            color: var(--foreground);
        }
        
        .volume-value {
            font-size: 12px;
            font-weight: 700;
            color: hsl(var(--ring));
        }
        
        .volume-slider {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background-color: var(--secondary);
            -webkit-appearance: none;
            appearance: none;
            outline: none;
            cursor: pointer;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background-color: var(--foreground);
            cursor: pointer;
            border: 2px solid var(--background);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .volume-presets {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
        }
        
        .volume-preset-btn {
            flex: 1;
            margin: 0 3px;
            padding: 6px 4px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background-color: var(--secondary);
            color: var(--muted-foreground);
        }
        
        .volume-preset-btn:hover {
            background-color: var(--accent);
            color: var(--accent-foreground);
        }
        
        .volume-preset-btn.active {
            background-color: var(--primary);
            color: var(--primary-foreground);
            border-color: var(--primary);
        }
        
        .volume-desc {
            font-size: 11px;
            color: var(--muted-foreground);
            margin-top: 12px;
            font-weight: 500;
        }
        
        .volume-warning {
            font-size: 11px;
            color: var(--destructive);
            margin-top: 8px;
            font-weight: 600;
            display: none;
        }
        
        .volume-warning.active {
            display: block;
        }
        

        /* ç¦ç”¨çŠ¶æ€ */
        .volume-control.disabled .volume-slider,
        .volume-control.disabled .volume-preset-btn {
            opacity: 0.4;
            pointer-events: none;
            cursor: not-allowed;
        }
        
        .volume-control.disabled .volume-value {
            color: var(--muted-foreground);
        }
        
        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 14px;
            font-weight: 700;
            color: var(--foreground);
            font-family: var(--font-mono);
        }
        
        .stat-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--muted-foreground);
            margin-top: 4px;
            text-transform: uppercase;
        }
        
        /* ==================== éŸ³é¢‘ç®¡ç†åŒºåŸŸæ ·å¼ ==================== */
        .audio-manager {
            text-align: left;
        }
        
        .audio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .audio-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--foreground);
            letter-spacing: -0.01em;
        }
        
        .refresh-btn {
            padding: 6px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background-color: var(--secondary);
            color: var(--foreground);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .refresh-btn:hover {
            background-color: hsl(var(--accent));
        }
        
        .audio-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            background-color: var(--sub-card);
        }
        
        .audio-item {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            transition: all 0.2s;
        }
        
        .audio-item:last-child {
            border-bottom: none;
        }
        
        .audio-item:hover {
            background-color: var(--secondary);
        }
        
        .audio-item.playing {
            background-color: hsla(var(--ring), 0.05);
            border-left: 3px solid hsl(var(--ring));
        }
        
        .audio-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .audio-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--foreground);
            word-break: break-all;
        }
        
        .audio-meta {
            display: flex;
            gap: 12px;
            font-size: 11px;
            color: var(--muted-foreground);
            margin-bottom: 12px;
            font-weight: 500;
        }
        
        .audio-controls {
            display: flex;
            gap: 8px;
        }
        
        .audio-btn {
            flex: 1;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            background-color: var(--sub-card);
            color: var(--foreground);
        }
        
        .audio-btn:hover {
            background-color: var(--secondary);
        }
        
        .audio-btn.play-btn {
            background-color: var(--primary);
            color: var(--primary-foreground);
            border-color: var(--primary);
        }
        
        .audio-btn.delete-btn {
            color: var(--destructive);
        }
        
        .audio-btn.delete-btn:hover {
            background-color: hsla(0, 84%, 60%, 0.1);
            border-color: var(--destructive);
        }
        
        .audio-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* æ’­æ”¾å™¨æ§åˆ¶æ¡ */
        .player-bar {
            background-color: var(--secondary);
            border-radius: 0.75rem;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
            display: none;
            animation: player-slide-in 0.3s ease-out;
        }

        @keyframes player-slide-in {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .player-bar.active {
            display: block;
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .player-filename {
            font-size: 13px;
            font-weight: 700;
            color: var(--foreground);
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-right: 12px;
        }
        
        .player-time {
            font-size: 12px;
            color: var(--muted-foreground);
            font-family: var(--font-mono);
            font-weight: 600;
        }
        
        .player-progress {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background-color: var(--border);
            cursor: pointer;
            position: relative;
            margin-bottom: 16px;
        }
        
        .player-progress-bar {
            height: 100%;
            border-radius: 2px;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.1s;
        }
        
        .player-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
        }
        
        .player-btn {
            width: 36px;
            height: 36px;
            border: 1px solid var(--border);
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--sub-card);
            color: var(--foreground);
        }
        
        .player-btn.main-btn {
            background-color: var(--primary);
            color: var(--primary-foreground);
            border-color: var(--primary);
            width: 48px;
            height: 48px;
            font-size: 20px;
        }
        
        .player-btn:hover {
            transform: scale(1.05);
            background-color: var(--accent);
        }
        
        /* ç©ºåˆ—è¡¨æç¤º */
        .empty-list {
            padding: 60px 20px;
            text-align: center;
            color: var(--muted-foreground);
        }
        
        .empty-list .icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-list .text {
            font-size: 14px;
            font-weight: 600;
        }
        
        /* åˆ é™¤ç¡®è®¤å¼¹çª— */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background-color: var(--sub-card);
            padding: 32px;
            border-radius: 1rem;
            max-width: 360px;
            width: 90%;
            text-align: center;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-beautiful-lg);
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--foreground);
            margin-bottom: 12px;
            letter-spacing: -0.02em;
        }
        
        .modal-text {
            font-size: 14px;
            color: var(--muted-foreground);
            margin-bottom: 24px;
            line-height: 1.5;
        }
        
        .modal-buttons {
            display: flex;
            gap: 12px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .modal-btn.cancel {
            background-color: var(--secondary);
            color: var(--foreground);
        }
        
        .modal-btn.confirm {
            background-color: var(--destructive);
            color: var(--destructive-foreground);
            border-color: var(--destructive);
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            padding: 40px;
            text-align: center;
            color: var(--muted-foreground);
        }
        
        .loading .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--secondary);
            border-top-color: var(--foreground);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="theme-toggle" id="themeToggle" title="åˆ‡æ¢æ·±è‰²/æµ…è‰²æ¨¡å¼">
            ğŸŒ“
        </button>
        <h1>ğŸ¤ æ— çº¿éº¦å…‹é£</h1>
        <p class="subtitle">å°†ä»»æ„è®¾å¤‡å˜æˆç”µè„‘éº¦å…‹é£</p>
        
        <div class="status disconnected" id="status">
            æœªè¿æ¥åˆ°æœåŠ¡å™¨
        </div>
        
        <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('mic')">ğŸ™ï¸ éº¦å…‹é£</button>
            <button class="tab-btn" onclick="switchTab('files')">ğŸ“ å½•éŸ³æ–‡ä»¶</button>
        </div>
        
        <!-- éº¦å…‹é£æ ‡ç­¾é¡µ -->
        <div class="tab-content active" id="tab-mic">
            <button class="record-button start" id="micButton">
                <span class="icon">ğŸ™ï¸</span>
                <span id="micButtonText">å¼€å¯éº¦å…‹é£</span>
            </button>
            
            <div class="volume-meter">
                <div class="volume-bar" id="volumeBar"></div>
            </div>
            
            <!-- è¿œç¨‹å½•åˆ¶æ§åˆ¶ -->
            <div class="record-control">
                <div class="record-header">
                    <span class="record-label">ğŸ“¼ ç”µè„‘ç«¯å½•åˆ¶æ§åˆ¶</span>
                    <span class="record-status idle" id="recordStatus">æœªå½•åˆ¶</span>
                </div>
                <button class="record-button start" id="recordButton" disabled>
                    <span class="icon">âº</span>
                    <span id="recordButtonText">å¼€å§‹å½•åˆ¶</span>
                </button>
                <div class="record-timer" id="recordTimer">00:00</div>
                <p class="record-hint" id="recordHint">è¯·å…ˆå¼€å¯éº¦å…‹é£</p>
            </div>
            
            <!-- è´¨é‡æ§åˆ¶ -->
            <div class="quality-control" id="qualityControl">
                <div class="quality-header">
                    <span class="quality-label">ğŸšï¸ éŸ³é¢‘è´¨é‡</span>
                    <span class="quality-value" id="qualityValue">æ ‡å‡†</span>
                </div>
                
                <div class="quality-presets" id="qualityPresets">
                    <button class="preset-btn" data-preset="smooth">æµç•…</button>
                    <button class="preset-btn active" data-preset="standard">æ ‡å‡†</button>
                    <button class="preset-btn" data-preset="high">é«˜è´¨é‡</button>
                    <button class="preset-btn" data-preset="ultra">æè‡´</button>
                    <button class="preset-btn" id="btnNativeMode">åŸç”Ÿ</button>
                </div>
                
                <p class="quality-desc" id="qualityDesc">æ ‡å‡†æ¨¡å¼ï¼š22kHz é‡‡æ ·ç‡ï¼Œå»¶è¿Ÿå’ŒéŸ³è´¨å¹³è¡¡</p>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="bufferSize">2048</div>
                        <div class="stat-label">ç¼“å†²åŒº</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="sampleRate">22k</div>
                        <div class="stat-label">é‡‡æ ·ç‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="latency">~46ms</div>
                        <div class="stat-label">é¢„è®¡å»¶è¿Ÿ</div>
                    </div>
                </div>
            </div>
            
            <!-- éŸ³é‡æ§åˆ¶ -->
            <div class="volume-control" id="volumeControl">
                <div class="volume-header">
                    <span class="volume-label">ğŸ”Š éŸ³é‡å¢ç›Š</span>
                    <span class="volume-value" id="volumeGainValue">100%</span>
                </div>
                <input type="range" class="volume-slider" id="volumeGainSlider" min="0" max="200" value="100">
                
                <div class="volume-presets">
                    <button class="volume-preset-btn" data-volume="0">é™éŸ³</button>
                    <button class="volume-preset-btn" data-volume="50">50%</button>
                    <button class="volume-preset-btn active" data-volume="100">100%</button>
                    <button class="volume-preset-btn" data-volume="150">150%</button>
                    <button class="volume-preset-btn" data-volume="200">200%</button>
                </div>
                
                <p class="volume-desc" id="volumeGainDesc">æ­£å¸¸éŸ³é‡ï¼šæ— å¢ç›Šå¤„ç†</p>
                <p class="volume-warning" id="volumeWarning">âš ï¸ éŸ³é‡è¿‡é«˜å¯èƒ½å¯¼è‡´å¤±çœŸ</p>
            </div>
            
            <div class="info">
                ç‚¹å‡»éº¦å…‹é£æŒ‰é’®å¼€å§‹/åœæ­¢ä¼ è¾“<br>
                ç¡®ä¿è®¾å¤‡ä¸ç”µè„‘åœ¨åŒä¸€å±€åŸŸç½‘
            </div>
        </div>
        
        <!-- å½•éŸ³æ–‡ä»¶æ ‡ç­¾é¡µ -->
        <div class="tab-content" id="tab-files">
            <div class="audio-manager">
                <div class="audio-header">
                    <span class="audio-title">ğŸ“ ç”µè„‘ç«¯å½•éŸ³æ–‡ä»¶</span>
                    <button class="refresh-btn" onclick="loadAudioList()">ğŸ”„ åˆ·æ–°</button>
                </div>
                
                <!-- æ’­æ”¾å™¨æ§åˆ¶æ¡ -->
                <div class="player-bar" id="playerBar">
                    <div class="player-info">
                        <span class="player-filename" id="playerFilename">æœªé€‰æ‹©æ–‡ä»¶</span>
                        <span class="player-time"><span id="playerCurrentTime">00:00</span> / <span id="playerDuration">00:00</span></span>
                    </div>
                    <div class="player-progress" id="playerProgress" onclick="seekAudio(event)">
                        <div class="player-progress-bar" id="playerProgressBar"></div>
                    </div>
                    <div class="player-buttons">
                        <button class="player-btn stop-btn" onclick="stopAudio()">â¹</button>
                        <button class="player-btn main-btn" id="mainPlayBtn" onclick="togglePlayPause()">â–¶ï¸</button>
                    </div>
                </div>
                
                <!-- éŸ³é¢‘åˆ—è¡¨ -->
                <div class="audio-list" id="audioList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>åŠ è½½ä¸­...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="error" id="error"></div>
    </div>
    
    <!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal-content">
            <div class="modal-title">âš ï¸ ç¡®è®¤åˆ é™¤</div>
            <div class="modal-text" id="deleteModalText">ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ</div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeDeleteModal()">å–æ¶ˆ</button>
                <button class="modal-btn confirm" onclick="confirmDelete()">åˆ é™¤</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        // ==================== å…ƒç´ å¼•ç”¨ ====================
        const statusEl = document.getElementById('status');
        const micButton = document.getElementById('micButton');
        const volumeBar = document.getElementById('volumeBar');
        const errorEl = document.getElementById('error');
        const qualitySlider = document.getElementById('qualitySlider');
        const qualityValue = document.getElementById('qualityValue');
        const qualityDesc = document.getElementById('qualityDesc');
        const bufferSizeEl = document.getElementById('bufferSize');
        const sampleRateEl = document.getElementById('sampleRate');
        const latencyEl = document.getElementById('latency');
        const presetBtns = document.querySelectorAll('.preset-btn');
        
        // éŸ³é‡æ§åˆ¶å…ƒç´ 
        const volumeControlPanel = document.getElementById('volumeControl');
        const volumeGainSlider = document.getElementById('volumeGainSlider');
        const volumeGainValue = document.getElementById('volumeGainValue');
        const volumeGainDesc = document.getElementById('volumeGainDesc');
        const volumeWarning = document.getElementById('volumeWarning');
        const volumePresetBtns = document.querySelectorAll('.volume-preset-btn');
        
        // åŸç”Ÿè´¨é‡æ¨¡å¼å…ƒç´ 
        const btnNativeMode = document.getElementById('btnNativeMode');
        
        // è¿œç¨‹å½•åˆ¶æ§åˆ¶å…ƒç´ 
        const recordButton = document.getElementById('recordButton');
        const recordButtonText = document.getElementById('recordButtonText');
        const recordStatus = document.getElementById('recordStatus');
        const recordTimer = document.getElementById('recordTimer');
        
        // éŸ³é¢‘ç®¡ç†å…ƒç´ 
        const audioListEl = document.getElementById('audioList');
        const playerBar = document.getElementById('playerBar');
        const playerFilename = document.getElementById('playerFilename');
        const playerCurrentTime = document.getElementById('playerCurrentTime');
        const playerDuration = document.getElementById('playerDuration');
        const playerProgressBar = document.getElementById('playerProgressBar');
        const mainPlayBtn = document.getElementById('mainPlayBtn');
        const deleteModal = document.getElementById('deleteModal');
        const deleteModalText = document.getElementById('deleteModalText');
        
        // ==================== çŠ¶æ€å˜é‡ ====================
        let socket;
        let audioContext;
        let mediaStream;
        let scriptProcessor;
        let isRecording = false;
        let analyser;
        
        // è¿œç¨‹å½•åˆ¶çŠ¶æ€
        let isServerRecording = false;
        let recordingStartTime = null;
        let recordingTimerInterval = null;
        
        // éº¦å…‹é£çŠ¶æ€
        let isMicActive = false;  // éº¦å…‹é£æ˜¯å¦å¼€å¯
        
        // éŸ³é¢‘è´¨é‡å‚æ•°
        let currentQuality = 50;
        let currentBufferSize = 1024;
        let currentSampleRate = 44100;
        
        // éŸ³é‡å¢ç›Šå‚æ•°
        let currentVolumeGain = 1.0; // é»˜è®¤100% = 1.0å€å¢ç›Š
        
        // åŸç”Ÿè´¨é‡æ¨¡å¼å‚æ•°
        let isNativeMode = false; // é»˜è®¤å…³é—­åŸç”Ÿæ¨¡å¼
        let useFloat32 = false; // æ˜¯å¦ä½¿ç”¨Float32æ ¼å¼
        
        // éŸ³é¢‘æ’­æ”¾ç›¸å…³
        let audioPlayer = null;
        let currentPlayingFile = null;
        let audioFiles = [];
        let fileToDelete = null;
        
        // ==================== æ ‡ç­¾é¡µåˆ‡æ¢ ====================
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // æ¿€æ´»å¯¹åº”æ ‡ç­¾
            event.currentTarget.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
            
            // åˆ‡æ¢åˆ°æ–‡ä»¶æ ‡ç­¾æ—¶åŠ è½½åˆ—è¡¨
            if (tabName === 'files') {
                loadAudioList();
            }
        }
        
        // ==================== éŸ³é¢‘æ–‡ä»¶ç®¡ç†åŠŸèƒ½ ====================
        // åŠ è½½éŸ³é¢‘æ–‡ä»¶åˆ—è¡¨
        async function loadAudioList() {
            audioListEl.innerHTML = '<div class="loading"><div class="spinner"></div><div>åŠ è½½ä¸­...</div></div>';
            
            try {
                const response = await fetch('/api/audio/list');
                const data = await response.json();
                
                if (data.success) {
                    audioFiles = data.files;
                    renderAudioList();
                } else {
                    audioListEl.innerHTML = '<div class="empty-list"><div class="icon">âŒ</div><div class="text">åŠ è½½å¤±è´¥: ' + data.error + '</div></div>';
                }
            } catch (error) {
                audioListEl.innerHTML = '<div class="empty-list"><div class="icon">âŒ</div><div class="text">ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥</div></div>';
            }
        }
        
        // æ¸²æŸ“éŸ³é¢‘åˆ—è¡¨
        function renderAudioList() {
            if (audioFiles.length === 0) {
                audioListEl.innerHTML = '<div class="empty-list"><div class="icon">ğŸ“­</div><div class="text">æš‚æ— å½•éŸ³æ–‡ä»¶</div></div>';
                return;
            }
            
            let html = '';
            audioFiles.forEach((file, index) => {
                const isPlaying = currentPlayingFile === file.filename;
                html += `
                    <div class="audio-item ${isPlaying ? 'playing' : ''}" data-filename="${file.filename}">
                        <div class="audio-name">${file.filename}</div>
                        <div class="audio-meta">
                            <span>â± ${file.duration_str}</span>
                            <span>ğŸ“¦ ${file.size_str}</span>
                            <span>ğŸ“… ${file.mtime}</span>
                        </div>
                        <div class="audio-controls">
                            <button class="audio-btn ${isPlaying ? 'pause-btn' : 'play-btn'}" onclick="playFile('${file.filename}')">
                                ${isPlaying && audioPlayer && !audioPlayer.paused ? 'â¸ æš‚åœ' : 'â–¶ï¸ æ’­æ”¾'}
                            </button>
                            <button class="audio-btn download-btn" onclick="downloadFile('${file.filename}')">â¬‡ï¸ ä¸‹è½½</button>
                            <button class="audio-btn delete-btn" onclick="showDeleteModal('${file.filename}')">ğŸ—‘ï¸ åˆ é™¤</button>
                        </div>
                    </div>
                `;
            });
            audioListEl.innerHTML = html;
        }
        
        // æ’­æ”¾æ–‡ä»¶
        function playFile(filename) {
            // å¦‚æœæ˜¯åŒä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ‡æ¢æ’­æ”¾/æš‚åœ
            if (currentPlayingFile === filename && audioPlayer) {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                    mainPlayBtn.textContent = 'â¸';
                } else {
                    audioPlayer.pause();
                    mainPlayBtn.textContent = 'â–¶ï¸';
                }
                renderAudioList();
                return;
            }
            
            // åœæ­¢å½“å‰æ’­æ”¾
            if (audioPlayer) {
                audioPlayer.pause();
                audioPlayer = null;
            }
            
            // åˆ›å»ºæ–°çš„æ’­æ”¾å™¨
            audioPlayer = new Audio('/api/audio/play/' + encodeURIComponent(filename));
            currentPlayingFile = filename;
            
            // æ˜¾ç¤ºæ’­æ”¾å™¨æ 
            playerBar.classList.add('active');
            playerFilename.textContent = filename;
            mainPlayBtn.textContent = 'â¸';
            
            // ç»‘å®šäº‹ä»¶
            audioPlayer.addEventListener('loadedmetadata', () => {
                playerDuration.textContent = formatTime(audioPlayer.duration);
            });
            
            audioPlayer.addEventListener('timeupdate', () => {
                const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                playerProgressBar.style.width = progress + '%';
                playerCurrentTime.textContent = formatTime(audioPlayer.currentTime);
            });
            
            audioPlayer.addEventListener('ended', () => {
                mainPlayBtn.textContent = 'â–¶ï¸';
                playerProgressBar.style.width = '0%';
                playerCurrentTime.textContent = '00:00';
                currentPlayingFile = null;
                renderAudioList();
            });
            
            audioPlayer.addEventListener('error', (e) => {
                showError('æ’­æ”¾å¤±è´¥: ' + (e.message || 'æœªçŸ¥é”™è¯¯'));
                currentPlayingFile = null;
                playerBar.classList.remove('active');
            });
            
            // å¼€å§‹æ’­æ”¾
            audioPlayer.play();
            renderAudioList();
        }
        
        // åˆ‡æ¢æ’­æ”¾/æš‚åœ
        function togglePlayPause() {
            if (!audioPlayer) return;
            
            if (audioPlayer.paused) {
                audioPlayer.play();
                mainPlayBtn.textContent = 'â¸';
            } else {
                audioPlayer.pause();
                mainPlayBtn.textContent = 'â–¶ï¸';
            }
            renderAudioList();
        }
        
        // åœæ­¢æ’­æ”¾
        function stopAudio() {
            if (audioPlayer) {
                audioPlayer.pause();
                audioPlayer.currentTime = 0;
                audioPlayer = null;
            }
            currentPlayingFile = null;
            playerBar.classList.remove('active');
            playerProgressBar.style.width = '0%';
            playerCurrentTime.textContent = '00:00';
            mainPlayBtn.textContent = 'â–¶ï¸';
            renderAudioList();
        }
        
        // è·³è½¬æ’­æ”¾ä½ç½®
        function seekAudio(event) {
            if (!audioPlayer) return;
            
            const progressEl = document.getElementById('playerProgress');
            const rect = progressEl.getBoundingClientRect();
            const percent = (event.clientX - rect.left) / rect.width;
            audioPlayer.currentTime = percent * audioPlayer.duration;
        }
        
        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(filename) {
            const link = document.createElement('a');
            link.href = '/api/audio/download/' + encodeURIComponent(filename);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // æ˜¾ç¤ºåˆ é™¤ç¡®è®¤å¼¹çª—
        function showDeleteModal(filename) {
            fileToDelete = filename;
            deleteModalText.textContent = 'ç¡®å®šè¦åˆ é™¤ "' + filename + '" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚';
            deleteModal.classList.add('active');
        }
        
        // å…³é—­åˆ é™¤å¼¹çª—
        function closeDeleteModal() {
            fileToDelete = null;
            deleteModal.classList.remove('active');
        }
        
        // ç¡®è®¤åˆ é™¤
        async function confirmDelete() {
            if (!fileToDelete) return;
            
            try {
                const response = await fetch('/api/audio/delete/' + encodeURIComponent(fileToDelete), {
                    method: 'DELETE'
                });
                const data = await response.json();
                
                if (data.success) {
                    // å¦‚æœæ­£åœ¨æ’­æ”¾è¢«åˆ é™¤çš„æ–‡ä»¶ï¼Œåœæ­¢æ’­æ”¾
                    if (currentPlayingFile === fileToDelete) {
                        stopAudio();
                    }
                    // åˆ·æ–°åˆ—è¡¨
                    loadAudioList();
                } else {
                    showError('åˆ é™¤å¤±è´¥: ' + data.error);
                }
            } catch (error) {
                showError('åˆ é™¤å¤±è´¥: ç½‘ç»œé”™è¯¯');
            }
            
            closeDeleteModal();
        }

        // ==================== è´¨é‡é¢„è®¾é…ç½® (5æ¡£) ====================
        // æ¯æ¡£å¯¹åº”ä¸åŒçš„é‡‡æ ·ç‡å’Œç¼“å†²åŒºï¼Œç”¨äºä¼˜åŒ–å¸¦å®½å’Œå»¶è¿Ÿ
        const qualityPresets = {
            smooth:   { name: 'æµç•…',   sampleRate: 16000, bufferSize: 512, desc: 'æµç•…æ¨¡å¼ï¼š16kHzï¼Œå®½å¸¦è¯­éŸ³ï¼Œå»¶è¿Ÿè¾ƒä½' },
            standard: { name: 'æ ‡å‡†',   sampleRate: 22050, bufferSize: 1024, desc: 'æ ‡å‡†æ¨¡å¼ï¼š22kHzï¼Œå¹¿æ’­éŸ³è´¨ï¼Œå»¶è¿Ÿä¸éŸ³è´¨å¹³è¡¡' },
            high:     { name: 'é«˜è´¨é‡', sampleRate: 32000, bufferSize: 2048, desc: 'é«˜è´¨é‡æ¨¡å¼ï¼š32kHzï¼ŒFMéŸ³è´¨ï¼ŒéŸ³è´¨æ›´å¥½' },
            ultra:    { name: 'æè‡´',   sampleRate: 44100, bufferSize: 4096, desc: 'æè‡´æ¨¡å¼ï¼š44.1kHzï¼ŒCDéŸ³è´¨ï¼Œæœ€é«˜éŸ³è´¨' }
        };
        
        let currentPreset = 'standard'; // å½“å‰é€‰ä¸­çš„é¢„è®¾
        
        // æ ¹æ®é¢„è®¾åç§°è·å–å‚æ•°
        function getPresetParams(presetName) {
            const preset = qualityPresets[presetName] || qualityPresets.standard;
            currentBufferSize = preset.bufferSize;
            currentSampleRate = preset.sampleRate;
            
            // è®¡ç®—é¢„è®¡å»¶è¿Ÿ (ms) = ç¼“å†²åŒºå¤§å° / é‡‡æ ·ç‡ * 1000
            const latency = Math.round((currentBufferSize / currentSampleRate) * 1000);
            
            return {
                bufferSize: preset.bufferSize,
                sampleRate: preset.sampleRate,
                latency: latency,
                desc: preset.desc,
                name: preset.name
            };
        }
        
        // æ›´æ–°è´¨é‡æ˜¾ç¤º
        function updateQualityDisplay(presetName) {
            currentPreset = presetName;
            const params = getPresetParams(presetName);
            
            qualityValue.textContent = params.name;
            bufferSizeEl.textContent = params.bufferSize;
            sampleRateEl.textContent = (params.sampleRate / 1000) + 'k';
            latencyEl.textContent = '~' + params.latency + 'ms';
            qualityDesc.textContent = params.desc;
            
            // æ›´æ–°é¢„è®¾æŒ‰é’®çŠ¶æ€
            presetBtns.forEach(btn => {
                if (btn.dataset.preset === presetName) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('audioPreset', presetName);
            
            // é€šçŸ¥åç«¯é‡‡æ ·ç‡å˜åŒ–
            if (socket && socket.connected) {
                socket.emit('update_config', { sampleRate: params.sampleRate });
                console.log('å·²é€šçŸ¥åç«¯é‡‡æ ·ç‡:', params.sampleRate);
            }
        }
        
        // é¢„è®¾æŒ‰é’®äº‹ä»¶
        presetBtns.forEach(btn => {
            btn.addEventListener('click', async () => {
                const presetName = btn.dataset.preset;
                if (!presetName) return; // å¿½ç•¥æ²¡æœ‰data-presetçš„æŒ‰é’®ï¼ˆå¦‚åŸç”ŸæŒ‰é’®ï¼‰

                // å¦‚æœå½“å‰æ˜¯åŸç”Ÿæ¨¡å¼ï¼Œéœ€è¦å…ˆå…³é—­
                if (isNativeMode) {
                    isNativeMode = false;
                    useFloat32 = false;
                    btnNativeMode.classList.remove('active');
                    
                    // æ¢å¤éŸ³é‡æ§åˆ¶
                    volumeControlPanel.classList.remove('disabled');
                    volumeGainValue.textContent = parseInt(volumeGainSlider.value) + '%';
                    
                    // é€šçŸ¥åç«¯å…³é—­åŸç”Ÿæ¨¡å¼
                    if (socket && socket.connected) {
                        socket.emit('set_native_mode', { enabled: false });
                    }
                    
                    // æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„åŸç”Ÿæ¨¡å¼è®¾ç½®
                    localStorage.removeItem('nativeMode');
                }
                
                updateQualityDisplay(presetName);
                
                if (isRecording) {
                    await restartRecordingKeepState();
                }
            });
        });
        
        // é‡å¯å½•éŸ³
        async function restartRecording() {
            stopRecording();
            await new Promise(resolve => setTimeout(resolve, 100));
            startRecording();
        }
        
        // è¿æ¥åˆ° WebSocket æœåŠ¡å™¨
        function connectSocket() {
            socket = io({
                transports: ['websocket'],
                upgrade: false
            });
            
            socket.on('connect', () => {
                statusEl.textContent = 'å·²è¿æ¥åˆ°ç”µè„‘';
                statusEl.className = 'status connected';
                errorEl.style.display = 'none';
                
                // å¯ç”¨éº¦å…‹é£æŒ‰é’®
                micButton.disabled = false;
                
                // å½•åˆ¶æŒ‰é’®çŠ¶æ€ç”±éº¦å…‹é£çŠ¶æ€æ§åˆ¶ï¼Œè¿æ¥åä¸è‡ªåŠ¨å¯ç”¨
                // è¯·æ±‚å½“å‰å½•åˆ¶çŠ¶æ€
                socket.emit('request_recording_status');
                // åŒæ­¥å½“å‰éº¦å…‹é£çŠ¶æ€
                syncMicStatus();
            });
            
            socket.on('disconnect', () => {
                statusEl.textContent = 'ä¸ç”µè„‘æ–­å¼€è¿æ¥';
                statusEl.className = 'status disconnected';
                stopRecording();
                
                // ç¦ç”¨éº¦å…‹é£æŒ‰é’®
                micButton.disabled = true;
                
                // ç¦ç”¨å½•åˆ¶æŒ‰é’®
                recordButton.disabled = true;
                updateRecordButtonHint();
                // é‡ç½®å½•åˆ¶UIçŠ¶æ€
                updateRecordingUI(false);
            });
            
            socket.on('connect_error', (error) => {
                showError('è¿æ¥å¤±è´¥: ' + error.message);
                recordButton.disabled = true;
            });
            
            // ç›‘å¬å½•åˆ¶çŠ¶æ€å˜åŒ–
            socket.on('recording_status', (data) => {
                console.log('æ”¶åˆ°å½•åˆ¶çŠ¶æ€:', data);
                updateRecordingUI(data.is_recording);
            });
            
            // âœ… ç›‘å¬åŸç”Ÿæ¨¡å¼çŠ¶æ€åŒæ­¥
            socket.on('native_mode_status', (data) => {
                console.log('æ”¶åˆ°åŸç”Ÿæ¨¡å¼çŠ¶æ€:', data);
                syncNativeModeFromServer(data.enabled);
            });
        }
        
        // æ›´æ–°å½•åˆ¶UIçŠ¶æ€
        function updateRecordingUI(serverRecording) {
            console.log('æ›´æ–°å½•åˆ¶UIçŠ¶æ€:', serverRecording);
            isServerRecording = serverRecording;
            
            if (serverRecording) {
                // æ­£åœ¨å½•åˆ¶
                recordButton.className = 'record-button stop';
                recordButtonText.textContent = 'åœæ­¢å½•åˆ¶';
                recordButton.querySelector('.icon').textContent = 'â¹';
                recordStatus.textContent = 'å½•åˆ¶ä¸­';
                recordStatus.className = 'record-status recording';
                recordTimer.classList.add('active');
                
                // å¼€å§‹è®¡æ—¶
                if (!recordingStartTime) {
                    recordingStartTime = Date.now();
                }
                startRecordingTimer();
            } else {
                // æœªå½•åˆ¶
                recordButton.className = 'record-button start';
                recordButtonText.textContent = 'å¼€å§‹å½•åˆ¶';
                recordButton.querySelector('.icon').textContent = 'âº';
                recordStatus.textContent = 'æœªå½•åˆ¶';
                recordStatus.className = 'record-status idle';
                recordTimer.classList.remove('active');
                
                // åœæ­¢è®¡æ—¶
                stopRecordingTimer();
            }
        }
        
        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // å¼€å§‹å½•åˆ¶è®¡æ—¶å™¨
        function startRecordingTimer() {
            if (recordingTimerInterval) return;
            
            recordingTimerInterval = setInterval(() => {
                if (recordingStartTime) {
                    const elapsed = (Date.now() - recordingStartTime) / 1000;
                    recordTimer.textContent = formatTime(elapsed);
                }
            }, 1000);
        }
        
        // åœæ­¢å½•åˆ¶è®¡æ—¶å™¨
        function stopRecordingTimer() {
            if (recordingTimerInterval) {
                clearInterval(recordingTimerInterval);
                recordingTimerInterval = null;
            }
            recordingStartTime = null;
            recordTimer.textContent = '00:00';
        }
        
        // å½•åˆ¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        recordButton.addEventListener('click', () => {
            if (!socket || !socket.connected) {
                showError('è¯·å…ˆè¿æ¥åˆ°æœåŠ¡å™¨');
                return;
            }
            
            // æ£€æŸ¥éº¦å…‹é£çŠ¶æ€
            if (!isMicActive) {
                showError('è¯·å…ˆå¼€å¯éº¦å…‹é£');
                return;
            }
            
            // å‘é€åˆ‡æ¢å½•åˆ¶çŠ¶æ€è¯·æ±‚
            socket.emit('toggle_recording');
            console.log('å‘é€å½•åˆ¶æ§åˆ¶è¯·æ±‚');
        });
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }
        
        // é‡é‡‡æ ·å‡½æ•° - å°†ä»»æ„é‡‡æ ·ç‡è½¬æ¢ä¸ºç›®æ ‡é‡‡æ ·ç‡
        function resample(inputData, inputSampleRate, outputSampleRate) {
            if (inputSampleRate === outputSampleRate) {
                return inputData;
            }
            
            const ratio = inputSampleRate / outputSampleRate;
            const outputLength = Math.round(inputData.length / ratio);
            const output = new Float32Array(outputLength);
            
            for (let i = 0; i < outputLength; i++) {
                const srcIndex = i * ratio;
                const srcIndexFloor = Math.floor(srcIndex);
                const srcIndexCeil = Math.min(srcIndexFloor + 1, inputData.length - 1);
                const t = srcIndex - srcIndexFloor;
                
                // çº¿æ€§æ’å€¼
                output[i] = inputData[srcIndexFloor] * (1 - t) + inputData[srcIndexCeil] * t;
            }
            
            return output;
        }
        
        // å¼€å§‹å½•éŸ³
        async function startRecording() {
            try {
                // è·å–å½“å‰é¢„è®¾å‚æ•°
                const params = getPresetParams(currentPreset);
                const targetSampleRate = isNativeMode ? 44100 : params.sampleRate;
                
                // è¯·æ±‚éº¦å…‹é£æƒé™ - ä¸å¼ºåˆ¶æŒ‡å®šé‡‡æ ·ç‡ï¼Œè®©è®¾å¤‡ä½¿ç”¨é»˜è®¤å€¼
                mediaStream = await navigator.mediaDevices.getUserMedia({
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true,
                        channelCount: 1
                    }
                });
                
                // éº¦å…‹é£å¼€å¯æˆåŠŸï¼Œæ›´æ–°çŠ¶æ€
                isMicActive = true;
                updateRecordButtonState();
                syncMicStatus();
                
                // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡ - ä¸æŒ‡å®šé‡‡æ ·ç‡ï¼Œä½¿ç”¨è®¾å¤‡é»˜è®¤å€¼
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // è·å–å®é™…é‡‡æ ·ç‡
                const actualSampleRate = audioContext.sampleRate;
                console.log('è®¾å¤‡å®é™…é‡‡æ ·ç‡:', actualSampleRate, 'ç›®æ ‡é‡‡æ ·ç‡:', targetSampleRate);
                
                const source = audioContext.createMediaStreamSource(mediaStream);
                
                // åˆ›å»ºåˆ†æå™¨ç”¨äºéŸ³é‡æ˜¾ç¤º
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                source.connect(analyser);
                
                // åˆ›å»ºéŸ³é¢‘å¤„ç†å™¨ - ä½¿ç”¨å½“å‰é¢„è®¾å¯¹åº”çš„ç¼“å†²åŒºå¤§å°
                const bufferSize = isNativeMode ? 4096 : params.bufferSize;
                scriptProcessor = audioContext.createScriptProcessor(bufferSize, 1, 1);
                source.connect(scriptProcessor);
                scriptProcessor.connect(audioContext.destination);
                
                // å¤„ç†éŸ³é¢‘æ•°æ®
                scriptProcessor.onaudioprocess = (e) => {
                    if (!isRecording) return;
                    
                    let inputData = e.inputBuffer.getChannelData(0);
                    
                    // é‡é‡‡æ ·åˆ°ç›®æ ‡é‡‡æ ·ç‡
                    if (actualSampleRate !== targetSampleRate) {
                        inputData = resample(inputData, actualSampleRate, targetSampleRate);
                    }
                    
                    if (useFloat32) {
                        // åŸç”Ÿè´¨é‡æ¨¡å¼ï¼šç›´æ¥å‘é€Float32æ•°æ®ï¼ˆæ— éŸ³é‡å¢ç›Šå¤„ç†, å›ºå®š44.1kï¼‰
                        const float32Data = new Float32Array(inputData);
                        socket.emit('audio_data', float32Data.buffer);
                    } else {
                        // æ™®é€šæ¨¡å¼ï¼šåº”ç”¨éŸ³é‡å¢ç›Šå¹¶è½¬æ¢ä¸ºInt16
                        const gainedData = new Float32Array(inputData.length);
                        for (let i = 0; i < inputData.length; i++) {
                            gainedData[i] = inputData[i] * currentVolumeGain;
                        }
                        
                        // è½¬æ¢ä¸º Int16 æ ¼å¼
                        const int16Data = new Int16Array(gainedData.length);
                        for (let i = 0; i < gainedData.length; i++) {
                            // åº”ç”¨å¢ç›Šåé™åˆ¶åœ¨ -1 åˆ° 1 ä¹‹é—´ï¼Œé˜²æ­¢å‰Šæ³¢
                            const s = Math.max(-1, Math.min(1, gainedData[i]));
                            int16Data[i] = s < 0 ? s * 0x8000 : s * 0x7FFF;
                        }
                        
                        // å‘é€åˆ°æœåŠ¡å™¨
                        socket.emit('audio_data', int16Data.buffer);
                    }
                };
                
                // æ›´æ–°éŸ³é‡æ˜¾ç¤º
                updateVolume();
                
                isRecording = true;
                micButton.className = 'record-button stop';
                document.getElementById('micButtonText').textContent = 'å…³é—­éº¦å…‹é£';
                micButton.querySelector('.icon').textContent = 'â¹';
                statusEl.textContent = 'æ­£åœ¨å½•éŸ³...';
                statusEl.className = 'status recording';
                
            } catch (error) {
                showError('æ— æ³•è®¿é—®éº¦å…‹é£: ' + error.message);
                console.error('éº¦å…‹é£è®¿é—®é”™è¯¯:', error);
            }
        }
        
        // åœæ­¢å½•éŸ³
        function stopRecording() {
            isRecording = false;
            
            if (scriptProcessor) {
                scriptProcessor.disconnect();
                scriptProcessor = null;
            }
            
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
            }
            
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
            
            micButton.className = 'record-button start';
            document.getElementById('micButtonText').textContent = 'å¼€å¯éº¦å…‹é£';
            micButton.querySelector('.icon').textContent = 'ğŸ™ï¸';
            if (socket && socket.connected) {
                statusEl.textContent = 'å·²è¿æ¥åˆ°ç”µè„‘';
                statusEl.className = 'status connected';
            }
            volumeBar.style.width = '0%';
            
            // éº¦å…‹é£å…³é—­ï¼Œæ›´æ–°çŠ¶æ€
            isMicActive = false;
            updateRecordButtonState();
            syncMicStatus();
        }
        
        // æ›´æ–°éŸ³é‡æ˜¾ç¤º
        function updateVolume() {
            if (!isRecording || !analyser) return;
            
            const dataArray = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(dataArray);
            
            const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
            const volume = Math.min(100, (average / 255) * 100 * 2);
            volumeBar.style.width = volume + '%';
            
            requestAnimationFrame(updateVolume);
        }
        
        // éº¦å…‹é£æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        micButton.addEventListener('click', () => {
            if (!socket || !socket.connected) {
                showError('è¯·å…ˆè¿æ¥åˆ°æœåŠ¡å™¨');
                return;
            }
            
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        });
        
        // ==================== éŸ³é‡å¢ç›Šæ§åˆ¶åŠŸèƒ½ ====================
        // æ›´æ–°éŸ³é‡å¢ç›Šæ˜¾ç¤º
        function updateVolumeGainDisplay(volumePercent) {
            volumeGainValue.textContent = volumePercent + '%';
            currentVolumeGain = volumePercent / 100.0;
            
            // æ›´æ–°æè¿°æ–‡å­—
            if (volumePercent === 0) {
                volumeGainDesc.textContent = 'é™éŸ³æ¨¡å¼ï¼šéŸ³é¢‘å·²å…³é—­';
            } else if (volumePercent < 50) {
                volumeGainDesc.textContent = 'é™ä½éŸ³é‡ï¼š' + volumePercent + '%';
            } else if (volumePercent === 100) {
                volumeGainDesc.textContent = 'æ­£å¸¸éŸ³é‡ï¼šæ— å¢ç›Šå¤„ç†';
            } else if (volumePercent <= 130) {
                volumeGainDesc.textContent = 'é€‚åº¦å¢ç›Šï¼š' + volumePercent + '%';
            } else {
                volumeGainDesc.textContent = 'é«˜å¢ç›Šï¼š' + volumePercent + '%ï¼ˆå»ºè®®è°¨æ…ä½¿ç”¨ï¼‰';
            }
            
            // æ›´æ–°è­¦å‘Šæç¤º
            if (volumePercent > 120) {
                volumeWarning.classList.add('active');
            } else {
                volumeWarning.classList.remove('active');
            }
            
            // æ›´æ–°é¢„è®¾æŒ‰é’®çŠ¶æ€
            volumePresetBtns.forEach(btn => {
                const presetVolume = parseInt(btn.dataset.volume);
                if (presetVolume === volumePercent) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('volumeGain', volumePercent);
            
            console.log('éŸ³é‡å¢ç›Šå·²è®¾ç½®ä¸º:', currentVolumeGain + 'x (' + volumePercent + '%)');
        }
        
        // éŸ³é‡æ»‘å—äº‹ä»¶
        volumeGainSlider.addEventListener('input', (e) => {
            const volumePercent = parseInt(e.target.value);
            updateVolumeGainDisplay(volumePercent);
        });
        
        // éŸ³é‡é¢„è®¾æŒ‰é’®äº‹ä»¶
        volumePresetBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const volumePercent = parseInt(btn.dataset.volume);
                volumeGainSlider.value = volumePercent;
                updateVolumeGainDisplay(volumePercent);
            });
        });
        
        // ==================== åŸç”Ÿè´¨é‡æ¨¡å¼åŠŸèƒ½ ====================
        
        // åˆ‡æ¢åˆ°åŸç”Ÿæ¨¡å¼
        async function switchToNativeMode() {
            if (isNativeMode) return;
            
            isNativeMode = true;
            useFloat32 = true;
            
            // UIæ›´æ–°
            btnNativeMode.classList.add('active');
            // å–æ¶ˆå…¶ä»–é¢„è®¾æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            presetBtns.forEach(btn => {
                if (btn !== btnNativeMode) btn.classList.remove('active');
            });
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            qualityValue.textContent = 'åŸç”Ÿ';
            bufferSizeEl.textContent = '4096';
            sampleRateEl.textContent = '44.1k';
            latencyEl.textContent = '~93ms';
            qualityDesc.textContent = 'åŸç”Ÿæ¨¡å¼ï¼š44.1kHz / Float32ï¼Œæ— æŸä¼ è¾“';
            
            // ç¦ç”¨éŸ³é‡æ§åˆ¶ä½†æ˜¾ç¤º100%
            volumeControlPanel.classList.add('disabled');
            volumeGainValue.textContent = '100%';
            
            // é€šçŸ¥åç«¯
            if (socket && socket.connected) {
                socket.emit('set_native_mode', { enabled: true });
            }
            
            // ä¿å­˜è®¾ç½®
            localStorage.setItem('nativeMode', 'true');
            
            // é‡å¯å½•éŸ³
            if (isRecording) {
                await restartRecordingKeepState();
            }
        }

        // åŒæ­¥æœåŠ¡ç«¯çš„åŸç”Ÿæ¨¡å¼çŠ¶æ€ï¼ˆå¼ºåˆ¶è¦†ç›–æœ¬åœ°çŠ¶æ€ï¼‰
        function syncNativeModeFromServer(enabled) {
            console.log('åŒæ­¥æœåŠ¡ç«¯åŸç”Ÿæ¨¡å¼çŠ¶æ€:', enabled);
            
            if (enabled) {
                // æœåŠ¡ç«¯æ˜¯åŸç”Ÿæ¨¡å¼
                isNativeMode = true;
                useFloat32 = true;
                
                // UIæ›´æ–°
                btnNativeMode.classList.add('active');
                presetBtns.forEach(btn => {
                    if (btn !== btnNativeMode) btn.classList.remove('active');
                });
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                qualityValue.textContent = 'åŸç”Ÿ';
                bufferSizeEl.textContent = '4096';
                sampleRateEl.textContent = '44.1k';
                latencyEl.textContent = '~93ms';
                qualityDesc.textContent = 'åŸç”Ÿæ¨¡å¼ï¼š44.1kHz / Float32ï¼Œæ— æŸä¼ è¾“';
                
                // ç¦ç”¨éŸ³é‡æ§åˆ¶
                volumeControlPanel.classList.add('disabled');
                volumeGainValue.textContent = '100%';
                
                // ä¿å­˜åˆ°æœ¬åœ°
                localStorage.setItem('nativeMode', 'true');
                
                console.log('å·²åŒæ­¥åˆ°åŸç”Ÿæ¨¡å¼');
            } else {
                // æœåŠ¡ç«¯ä¸æ˜¯åŸç”Ÿæ¨¡å¼
                isNativeMode = false;
                useFloat32 = false;
                
                // UIæ›´æ–°
                btnNativeMode.classList.remove('active');
                
                // æ¢å¤åˆ°ä¸Šæ¬¡çš„æ ‡å‡†é¢„è®¾
                const savedPreset = localStorage.getItem('audioPreset') || 'standard';
                updateQualityDisplay(savedPreset);
                
                // æ¢å¤éŸ³é‡æ§åˆ¶
                volumeControlPanel.classList.remove('disabled');
                const savedVolume = localStorage.getItem('volumeGain') || '100';
                volumeGainSlider.value = savedVolume;
                updateVolumeGainDisplay(parseInt(savedVolume));
                
                // æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„åŸç”Ÿæ¨¡å¼
                localStorage.removeItem('nativeMode');
                
                console.log('å·²åŒæ­¥åˆ°éåŸç”Ÿæ¨¡å¼');
            }
            
            // å¦‚æœæ­£åœ¨å½•éŸ³ï¼Œé‡å¯å½•éŸ³ä»¥åº”ç”¨æ–°è®¾ç½®
            if (isRecording) {
                console.log('æ­£åœ¨å½•éŸ³ï¼Œå°†é‡å¯ä»¥åº”ç”¨æ–°è®¾ç½®');
                restartRecordingKeepState();
            }
        }
        
        // åŸç”Ÿè´¨é‡æ¨¡å¼æŒ‰é’®äº‹ä»¶
        btnNativeMode.addEventListener('click', switchToNativeMode);
        
        // é‡å¯å½•éŸ³å¹¶ä¿æŒçŠ¶æ€ï¼ˆç”¨äºåˆ‡æ¢éŸ³é¢‘æ ¼å¼æ—¶ï¼‰
        async function restartRecordingKeepState() {
            const wasRecording = isRecording;
            
            if (wasRecording) {
                stopRecording();
                await new Promise(resolve => setTimeout(resolve, 100));
                startRecording();
            }
        }
        
        // ==================== ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ ====================
        const themeToggle = document.getElementById('themeToggle');
        
        function setTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
                document.body.classList.remove('light-mode');
                themeToggle.innerHTML = 'â˜€ï¸';
            } else if (theme === 'light') {
                document.body.classList.add('light-mode');
                document.body.classList.remove('dark-mode');
                themeToggle.innerHTML = 'ğŸŒ™';
            } else {
                // è·Ÿéšç³»ç»Ÿ
                document.body.classList.remove('dark-mode');
                document.body.classList.remove('light-mode');
                const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                themeToggle.innerHTML = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
            }
            localStorage.setItem('themePreference', theme);
        }

        themeToggle.addEventListener('click', () => {
            const isDark = document.body.classList.contains('dark-mode') || 
                          (!document.body.classList.contains('light-mode') && 
                           window.matchMedia('(prefers-color-scheme: dark)').matches);
            
            setTheme(isDark ? 'light' : 'dark');
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        function init() {
            // åˆå§‹ç¦ç”¨éº¦å…‹é£æŒ‰é’®ï¼ˆç­‰å¾…è¿æ¥ï¼‰
            micButton.disabled = true;
            
            // åˆå§‹åŒ–ä¸»é¢˜
            const savedTheme = localStorage.getItem('themePreference') || 'system';
            setTheme(savedTheme);
            
            // æ¸…é™¤å¯èƒ½å¯¼è‡´é—®é¢˜çš„æ—§è®¾ç½®
            const pageVersion = 'v4'; // æ›´æ–°ç‰ˆæœ¬å·ä»¥æ”¯æŒ5æ¡£é¢„è®¾
            if (localStorage.getItem('pageVersion') !== pageVersion) {
                localStorage.removeItem('audioQuality');
                localStorage.removeItem('audioPreset');
                localStorage.removeItem('volumeGain');
                localStorage.setItem('pageVersion', pageVersion);
                console.log('å·²æ¸…é™¤æ—§ç‰ˆæœ¬è®¾ç½®');
            }
            
            // ä»æœ¬åœ°å­˜å‚¨è¯»å–è´¨é‡é¢„è®¾è®¾ç½®
            const savedPreset = localStorage.getItem('audioPreset');
            if (savedPreset && qualityPresets[savedPreset]) {
                currentPreset = savedPreset;
            }
            updateQualityDisplay(currentPreset);
            
            // ä»æœ¬åœ°å­˜å‚¨è¯»å–éŸ³é‡è®¾ç½®
            const savedVolume = localStorage.getItem('volumeGain');
            if (savedVolume) {
                const volumePercent = parseInt(savedVolume);
                volumeGainSlider.value = volumePercent;
                updateVolumeGainDisplay(volumePercent);
            } else {
                // é»˜è®¤100%
                updateVolumeGainDisplay(100);
            }
            
            // ä»æœ¬åœ°å­˜å‚¨è¯»å–åŸç”Ÿæ¨¡å¼è®¾ç½®
            const savedNativeMode = localStorage.getItem('nativeMode');
            if (savedNativeMode === 'true') {
                isNativeMode = true;
                useFloat32 = true;
                btnNativeMode.classList.add('active');
                presetBtns.forEach(btn => {
                    if (btn !== btnNativeMode) btn.classList.remove('active');
                });
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                qualityValue.textContent = 'åŸç”Ÿ';
                bufferSizeEl.textContent = '4096';
                sampleRateEl.textContent = '44.1k';
                latencyEl.textContent = '~93ms';
                qualityDesc.textContent = 'åŸç”Ÿæ¨¡å¼ï¼š44.1kHz / Float32ï¼Œæ— æŸä¼ è¾“';
                
                volumeControlPanel.classList.add('disabled');
                volumeGainValue.textContent = '100%';
                console.log('å·²æ¢å¤åŸç”Ÿè´¨é‡æ¨¡å¼è®¾ç½®');
            }
            
            // è¿æ¥æœåŠ¡å™¨
            connectSocket();
        }
        
        init();
        
        // ==================== éº¦å…‹é£çŠ¶æ€åŒæ­¥åŠŸèƒ½ ====================
        // åŒæ­¥éº¦å…‹é£çŠ¶æ€åˆ°æœåŠ¡å™¨
        function syncMicStatus() {
            if (socket && socket.connected) {
                socket.emit('mic_status', { is_open: isMicActive });
                console.log('åŒæ­¥éº¦å…‹é£çŠ¶æ€:', isMicActive);
            }
        }
        
        // æ›´æ–°å½•åˆ¶æŒ‰é’®çŠ¶æ€
        function updateRecordButtonState() {
            if (socket && socket.connected && isMicActive) {
                // éº¦å…‹é£å¼€å¯ä¸”å·²è¿æ¥ï¼Œå¯ç”¨å½•åˆ¶æŒ‰é’®
                recordButton.disabled = false;
            } else {
                // éº¦å…‹é£å…³é—­æˆ–æœªè¿æ¥ï¼Œç¦ç”¨å½•åˆ¶æŒ‰é’®
                recordButton.disabled = true;
            }
            updateRecordButtonHint();
        }
        
        // æ›´æ–°å½•åˆ¶æŒ‰é’®æç¤ºæ–‡å­—
        function updateRecordButtonHint() {
            const hintEl = document.getElementById('recordHint');
            if (!socket || !socket.connected) {
                hintEl.textContent = 'è¯·å…ˆè¿æ¥åˆ°æœåŠ¡å™¨';
            } else if (!isMicActive) {
                hintEl.textContent = 'è¯·å…ˆå¼€å¯éº¦å…‹é£';
            } else {
                hintEl.textContent = 'æ§åˆ¶ç”µè„‘ç«¯å¼€å§‹/åœæ­¢å½•åˆ¶éŸ³é¢‘åˆ°æœ¬åœ°';
            }
        }
        
        // é¡µé¢å¸è½½æ—¶æ¸…ç†
        window.addEventListener('beforeunload', () => {
            stopRecording();
            if (socket) socket.disconnect();
        });
    </script>
</body>
</html>
