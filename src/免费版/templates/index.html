<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ— çº¿éº¦å…‹é£</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 420px;
            width: 100%;
            text-align: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 26px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 20px;
            font-size: 13px;
        }
        
        .status {
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .status.disconnected {
            background: #fee;
            color: #c33;
        }
        
        .status.connected {
            background: #efe;
            color: #3c3;
        }
        
        .status.recording {
            background: #ffeaa7;
            color: #d63031;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* æ ‡ç­¾é¡µå¯¼èˆª */
        .tab-nav {
            display: flex;
            margin-bottom: 15px;
            border-radius: 10px;
            overflow: hidden;
            background: #f0f0f0;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px 10px;
            border: none;
            background: transparent;
            color: #666;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-btn:hover:not(.active) {
            background: #e0e0e0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .mic-button {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 45px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            margin: 15px auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mic-button:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }
        
        .mic-button:active {
            transform: scale(0.95);
        }
        
        .mic-button.recording {
            background: linear-gradient(135deg, #d63031 0%, #e17055 100%);
            animation: recording-pulse 1s infinite;
        }
        
        @keyframes recording-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .info {
            color: #666;
            font-size: 12px;
            margin-top: 15px;
            line-height: 1.5;
        }
        
        .volume-meter {
            width: 100%;
            height: 6px;
            background: #eee;
            border-radius: 3px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .volume-bar {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #fdcb6e, #d63031);
            width: 0%;
            transition: width 0.1s ease;
        }
        
        .error {
            background: #fee;
            color: #c33;
            padding: 12px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 13px;
            display: none;
        }
        
        /* è¿œç¨‹å½•åˆ¶æ§åˆ¶åŒºåŸŸ */
        .record-control {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 12px;
            margin: 15px 0;
        }
        
        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .record-label {
            font-size: 13px;
            font-weight: 600;
            color: #333;
        }
        
        .record-status {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .record-status.idle {
            background: #e9ecef;
            color: #6c757d;
        }
        
        .record-status.recording {
            background: #d63031;
            color: white;
            animation: pulse 1.5s infinite;
        }
        
        .record-button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .record-button.start {
            background: linear-gradient(135deg, #d63031 0%, #e17055 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(214, 48, 49, 0.3);
        }
        
        .record-button.start:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(214, 48, 49, 0.4);
        }
        
        .record-button.stop {
            background: linear-gradient(135deg, #636e72 0%, #2d3436 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(45, 52, 54, 0.3);
        }
        
        .record-button.stop:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(45, 52, 54, 0.4);
        }
        
        .record-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .record-button .icon {
            font-size: 18px;
        }
        
        .record-timer {
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            color: #d63031;
            margin-top: 8px;
            font-family: 'Consolas', monospace;
            display: none;
        }
        
        .record-timer.active {
            display: block;
        }
        
        .record-hint {
            font-size: 10px;
            color: #888;
            text-align: center;
            margin-top: 6px;
        }
        
        /* è´¨é‡æ§åˆ¶åŒºåŸŸ */
        .quality-control {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 12px;
            margin: 15px 0;
        }
        
        .quality-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .quality-label {
            font-size: 13px;
            font-weight: 600;
            color: #333;
        }
        
        .quality-value {
            font-size: 13px;
            font-weight: 600;
            color: #667eea;
            min-width: 50px;
        }
        
        .quality-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(90deg, #00b894, #fdcb6e, #667eea);
            -webkit-appearance: none;
            appearance: none;
            outline: none;
            cursor: pointer;
        }
        
        .quality-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .quality-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }
        
        .quality-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            border: none;
        }
        
        .quality-presets {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }
        
        .preset-btn {
            flex: 1;
            margin: 0 2px;
            padding: 6px 4px;
            border: none;
            border-radius: 5px;
            font-size: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            background: #e9ecef;
            color: #495057;
        }
        
        .preset-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .preset-btn.active {
            background: #667eea;
            color: white;
        }
        
        .quality-desc {
            font-size: 10px;
            color: #888;
            margin-top: 6px;
        }
        
        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #eee;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 9px;
            color: #888;
            margin-top: 2px;
        }
        
        /* ==================== éŸ³é¢‘ç®¡ç†åŒºåŸŸæ ·å¼ ==================== */
        .audio-manager {
            text-align: left;
        }
        
        .audio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .audio-title {
            font-size: 15px;
            font-weight: 600;
            color: #333;
        }
        
        .refresh-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            background: #667eea;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .refresh-btn:hover {
            background: #5a6fd6;
        }
        
        .audio-list {
            max-height: 350px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 10px;
        }
        
        .audio-item {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }
        
        .audio-item:last-child {
            border-bottom: none;
        }
        
        .audio-item:hover {
            background: #f8f9fa;
        }
        
        .audio-item.playing {
            background: #e8f4ff;
        }
        
        .audio-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .audio-name {
            font-size: 13px;
            font-weight: 500;
            color: #333;
            word-break: break-all;
        }
        
        .audio-meta {
            display: flex;
            gap: 10px;
            font-size: 11px;
            color: #888;
            margin-bottom: 8px;
        }
        
        .audio-controls {
            display: flex;
            gap: 6px;
        }
        
        .audio-btn {
            flex: 1;
            padding: 8px 10px;
            border: none;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .audio-btn.play-btn {
            background: #00b894;
            color: white;
        }
        
        .audio-btn.play-btn:hover {
            background: #00a884;
        }
        
        .audio-btn.pause-btn {
            background: #fdcb6e;
            color: #333;
        }
        
        .audio-btn.pause-btn:hover {
            background: #f9c44d;
        }
        
        .audio-btn.download-btn {
            background: #667eea;
            color: white;
        }
        
        .audio-btn.download-btn:hover {
            background: #5a6fd6;
        }
        
        .audio-btn.delete-btn {
            background: #d63031;
            color: white;
        }
        
        .audio-btn.delete-btn:hover {
            background: #c62828;
        }
        
        .audio-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* æ’­æ”¾å™¨æ§åˆ¶æ¡ */
        .player-bar {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 12px;
            display: none;
        }
        
        .player-bar.active {
            display: block;
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .player-filename {
            font-size: 13px;
            font-weight: 500;
            color: #333;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .player-time {
            font-size: 12px;
            color: #666;
            font-family: 'Consolas', monospace;
        }
        
        .player-progress {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            cursor: pointer;
            position: relative;
            margin-bottom: 8px;
        }
        
        .player-progress-bar {
            height: 100%;
            border-radius: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.1s;
        }
        
        .player-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .player-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .player-btn.main-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 50px;
            height: 50px;
            font-size: 22px;
        }
        
        .player-btn.main-btn:hover {
            transform: scale(1.05);
        }
        
        .player-btn.stop-btn {
            background: #d63031;
            color: white;
        }
        
        .player-btn.stop-btn:hover {
            background: #c62828;
        }
        
        /* ç©ºåˆ—è¡¨æç¤º */
        .empty-list {
            padding: 40px 20px;
            text-align: center;
            color: #999;
        }
        
        .empty-list .icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .empty-list .text {
            font-size: 14px;
        }
        
        /* åˆ é™¤ç¡®è®¤å¼¹çª— */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            max-width: 320px;
            width: 90%;
            text-align: center;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .modal-text {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            word-break: break-all;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .modal-btn.cancel {
            background: #e9ecef;
            color: #333;
        }
        
        .modal-btn.cancel:hover {
            background: #ddd;
        }
        
        .modal-btn.confirm {
            background: #d63031;
            color: white;
        }
        
        .modal-btn.confirm:hover {
            background: #c62828;
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            padding: 30px;
            text-align: center;
            color: #666;
        }
        
        .loading .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #eee;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ æ— çº¿éº¦å…‹é£</h1>
        <p class="subtitle">å°†ä»»æ„è®¾å¤‡å˜æˆç”µè„‘éº¦å…‹é£</p>
        
        <div class="status disconnected" id="status">
            æœªè¿æ¥åˆ°æœåŠ¡å™¨
        </div>
        
        <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('mic')">ğŸ™ï¸ éº¦å…‹é£</button>
            <button class="tab-btn" onclick="switchTab('files')">ğŸ“ å½•éŸ³æ–‡ä»¶</button>
        </div>
        
        <!-- éº¦å…‹é£æ ‡ç­¾é¡µ -->
        <div class="tab-content active" id="tab-mic">
            <button class="mic-button" id="micButton">
                ğŸ™ï¸
            </button>
            
            <div class="volume-meter">
                <div class="volume-bar" id="volumeBar"></div>
            </div>
            
            <!-- è¿œç¨‹å½•åˆ¶æ§åˆ¶ -->
            <div class="record-control">
                <div class="record-header">
                    <span class="record-label">ğŸ“¼ ç”µè„‘ç«¯å½•åˆ¶æ§åˆ¶</span>
                    <span class="record-status idle" id="recordStatus">æœªå½•åˆ¶</span>
                </div>
                <button class="record-button start" id="recordButton" disabled>
                    <span class="icon">âº</span>
                    <span id="recordButtonText">å¼€å§‹å½•åˆ¶</span>
                </button>
                <div class="record-timer" id="recordTimer">00:00</div>
                <p class="record-hint">æ§åˆ¶ç”µè„‘ç«¯å¼€å§‹/åœæ­¢å½•åˆ¶éŸ³é¢‘åˆ°æœ¬åœ°</p>
            </div>
            
            <!-- è´¨é‡æ§åˆ¶ -->
            <div class="quality-control">
                <div class="quality-header">
                    <span class="quality-label">ğŸšï¸ éŸ³é¢‘è´¨é‡</span>
                    <span class="quality-value" id="qualityValue">50</span>
                </div>
                <input type="range" class="quality-slider" id="qualitySlider" min="1" max="100" value="50">
                
                <div class="quality-presets">
                    <button class="preset-btn" data-quality="10">ä½å»¶è¿Ÿ</button>
                    <button class="preset-btn" data-quality="30">æµç•…</button>
                    <button class="preset-btn active" data-quality="50">å¹³è¡¡</button>
                    <button class="preset-btn" data-quality="75">é«˜è´¨é‡</button>
                    <button class="preset-btn" data-quality="100">æè‡´</button>
                </div>
                
                <p class="quality-desc" id="qualityDesc">å¹³è¡¡æ¨¡å¼ï¼šå»¶è¿Ÿå’ŒéŸ³è´¨çš„æœ€ä½³å¹³è¡¡</p>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="bufferSize">1024</div>
                        <div class="stat-label">ç¼“å†²åŒº</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="sampleRate">44.1k</div>
                        <div class="stat-label">é‡‡æ ·ç‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="latency">~23ms</div>
                        <div class="stat-label">é¢„è®¡å»¶è¿Ÿ</div>
                    </div>
                </div>
            </div>
            
            <div class="info">
                ç‚¹å‡»éº¦å…‹é£æŒ‰é’®å¼€å§‹/åœæ­¢ä¼ è¾“<br>
                ç¡®ä¿è®¾å¤‡ä¸ç”µè„‘åœ¨åŒä¸€å±€åŸŸç½‘
            </div>
        </div>
        
        <!-- å½•éŸ³æ–‡ä»¶æ ‡ç­¾é¡µ -->
        <div class="tab-content" id="tab-files">
            <div class="audio-manager">
                <div class="audio-header">
                    <span class="audio-title">ğŸ“ ç”µè„‘ç«¯å½•éŸ³æ–‡ä»¶</span>
                    <button class="refresh-btn" onclick="loadAudioList()">ğŸ”„ åˆ·æ–°</button>
                </div>
                
                <!-- æ’­æ”¾å™¨æ§åˆ¶æ¡ -->
                <div class="player-bar" id="playerBar">
                    <div class="player-info">
                        <span class="player-filename" id="playerFilename">æœªé€‰æ‹©æ–‡ä»¶</span>
                        <span class="player-time"><span id="playerCurrentTime">00:00</span> / <span id="playerDuration">00:00</span></span>
                    </div>
                    <div class="player-progress" id="playerProgress" onclick="seekAudio(event)">
                        <div class="player-progress-bar" id="playerProgressBar"></div>
                    </div>
                    <div class="player-buttons">
                        <button class="player-btn stop-btn" onclick="stopAudio()">â¹</button>
                        <button class="player-btn main-btn" id="mainPlayBtn" onclick="togglePlayPause()">â–¶ï¸</button>
                    </div>
                </div>
                
                <!-- éŸ³é¢‘åˆ—è¡¨ -->
                <div class="audio-list" id="audioList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>åŠ è½½ä¸­...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="error" id="error"></div>
    </div>
    
    <!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal-content">
            <div class="modal-title">âš ï¸ ç¡®è®¤åˆ é™¤</div>
            <div class="modal-text" id="deleteModalText">ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ</div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeDeleteModal()">å–æ¶ˆ</button>
                <button class="modal-btn confirm" onclick="confirmDelete()">åˆ é™¤</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        // ==================== å…ƒç´ å¼•ç”¨ ====================
        const statusEl = document.getElementById('status');
        const micButton = document.getElementById('micButton');
        const volumeBar = document.getElementById('volumeBar');
        const errorEl = document.getElementById('error');
        const qualitySlider = document.getElementById('qualitySlider');
        const qualityValue = document.getElementById('qualityValue');
        const qualityDesc = document.getElementById('qualityDesc');
        const bufferSizeEl = document.getElementById('bufferSize');
        const sampleRateEl = document.getElementById('sampleRate');
        const latencyEl = document.getElementById('latency');
        const presetBtns = document.querySelectorAll('.preset-btn');
        
        // è¿œç¨‹å½•åˆ¶æ§åˆ¶å…ƒç´ 
        const recordButton = document.getElementById('recordButton');
        const recordButtonText = document.getElementById('recordButtonText');
        const recordStatus = document.getElementById('recordStatus');
        const recordTimer = document.getElementById('recordTimer');
        
        // éŸ³é¢‘ç®¡ç†å…ƒç´ 
        const audioListEl = document.getElementById('audioList');
        const playerBar = document.getElementById('playerBar');
        const playerFilename = document.getElementById('playerFilename');
        const playerCurrentTime = document.getElementById('playerCurrentTime');
        const playerDuration = document.getElementById('playerDuration');
        const playerProgressBar = document.getElementById('playerProgressBar');
        const mainPlayBtn = document.getElementById('mainPlayBtn');
        const deleteModal = document.getElementById('deleteModal');
        const deleteModalText = document.getElementById('deleteModalText');
        
        // ==================== çŠ¶æ€å˜é‡ ====================
        let socket;
        let audioContext;
        let mediaStream;
        let scriptProcessor;
        let isRecording = false;
        let analyser;
        
        // è¿œç¨‹å½•åˆ¶çŠ¶æ€
        let isServerRecording = false;
        let recordingStartTime = null;
        let recordingTimerInterval = null;
        
        // éŸ³é¢‘è´¨é‡å‚æ•°
        let currentQuality = 50;
        let currentBufferSize = 1024;
        let currentSampleRate = 44100;
        
        // éŸ³é¢‘æ’­æ”¾ç›¸å…³
        let audioPlayer = null;
        let currentPlayingFile = null;
        let audioFiles = [];
        let fileToDelete = null;
        
        // ==================== æ ‡ç­¾é¡µåˆ‡æ¢ ====================
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // æ¿€æ´»å¯¹åº”æ ‡ç­¾
            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
            
            // åˆ‡æ¢åˆ°æ–‡ä»¶æ ‡ç­¾æ—¶åŠ è½½åˆ—è¡¨
            if (tabName === 'files') {
                loadAudioList();
            }
        }
        
        // ==================== éŸ³é¢‘æ–‡ä»¶ç®¡ç†åŠŸèƒ½ ====================
        // åŠ è½½éŸ³é¢‘æ–‡ä»¶åˆ—è¡¨
        async function loadAudioList() {
            audioListEl.innerHTML = '<div class="loading"><div class="spinner"></div><div>åŠ è½½ä¸­...</div></div>';
            
            try {
                const response = await fetch('/api/audio/list');
                const data = await response.json();
                
                if (data.success) {
                    audioFiles = data.files;
                    renderAudioList();
                } else {
                    audioListEl.innerHTML = '<div class="empty-list"><div class="icon">âŒ</div><div class="text">åŠ è½½å¤±è´¥: ' + data.error + '</div></div>';
                }
            } catch (error) {
                audioListEl.innerHTML = '<div class="empty-list"><div class="icon">âŒ</div><div class="text">ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥</div></div>';
            }
        }
        
        // æ¸²æŸ“éŸ³é¢‘åˆ—è¡¨
        function renderAudioList() {
            if (audioFiles.length === 0) {
                audioListEl.innerHTML = '<div class="empty-list"><div class="icon">ğŸ“­</div><div class="text">æš‚æ— å½•éŸ³æ–‡ä»¶</div></div>';
                return;
            }
            
            let html = '';
            audioFiles.forEach((file, index) => {
                const isPlaying = currentPlayingFile === file.filename;
                html += `
                    <div class="audio-item ${isPlaying ? 'playing' : ''}" data-filename="${file.filename}">
                        <div class="audio-name">${file.filename}</div>
                        <div class="audio-meta">
                            <span>â± ${file.duration_str}</span>
                            <span>ğŸ“¦ ${file.size_str}</span>
                            <span>ğŸ“… ${file.mtime}</span>
                        </div>
                        <div class="audio-controls">
                            <button class="audio-btn ${isPlaying ? 'pause-btn' : 'play-btn'}" onclick="playFile('${file.filename}')">
                                ${isPlaying && audioPlayer && !audioPlayer.paused ? 'â¸ æš‚åœ' : 'â–¶ï¸ æ’­æ”¾'}
                            </button>
                            <button class="audio-btn download-btn" onclick="downloadFile('${file.filename}')">â¬‡ï¸ ä¸‹è½½</button>
                            <button class="audio-btn delete-btn" onclick="showDeleteModal('${file.filename}')">ğŸ—‘ï¸ åˆ é™¤</button>
                        </div>
                    </div>
                `;
            });
            audioListEl.innerHTML = html;
        }
        
        // æ’­æ”¾æ–‡ä»¶
        function playFile(filename) {
            // å¦‚æœæ˜¯åŒä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ‡æ¢æ’­æ”¾/æš‚åœ
            if (currentPlayingFile === filename && audioPlayer) {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                    mainPlayBtn.textContent = 'â¸';
                } else {
                    audioPlayer.pause();
                    mainPlayBtn.textContent = 'â–¶ï¸';
                }
                renderAudioList();
                return;
            }
            
            // åœæ­¢å½“å‰æ’­æ”¾
            if (audioPlayer) {
                audioPlayer.pause();
                audioPlayer = null;
            }
            
            // åˆ›å»ºæ–°çš„æ’­æ”¾å™¨
            audioPlayer = new Audio('/api/audio/play/' + encodeURIComponent(filename));
            currentPlayingFile = filename;
            
            // æ˜¾ç¤ºæ’­æ”¾å™¨æ 
            playerBar.classList.add('active');
            playerFilename.textContent = filename;
            mainPlayBtn.textContent = 'â¸';
            
            // ç»‘å®šäº‹ä»¶
            audioPlayer.addEventListener('loadedmetadata', () => {
                playerDuration.textContent = formatTime(audioPlayer.duration);
            });
            
            audioPlayer.addEventListener('timeupdate', () => {
                const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                playerProgressBar.style.width = progress + '%';
                playerCurrentTime.textContent = formatTime(audioPlayer.currentTime);
            });
            
            audioPlayer.addEventListener('ended', () => {
                mainPlayBtn.textContent = 'â–¶ï¸';
                playerProgressBar.style.width = '0%';
                playerCurrentTime.textContent = '00:00';
                currentPlayingFile = null;
                renderAudioList();
            });
            
            audioPlayer.addEventListener('error', (e) => {
                showError('æ’­æ”¾å¤±è´¥: ' + (e.message || 'æœªçŸ¥é”™è¯¯'));
                currentPlayingFile = null;
                playerBar.classList.remove('active');
            });
            
            // å¼€å§‹æ’­æ”¾
            audioPlayer.play();
            renderAudioList();
        }
        
        // åˆ‡æ¢æ’­æ”¾/æš‚åœ
        function togglePlayPause() {
            if (!audioPlayer) return;
            
            if (audioPlayer.paused) {
                audioPlayer.play();
                mainPlayBtn.textContent = 'â¸';
            } else {
                audioPlayer.pause();
                mainPlayBtn.textContent = 'â–¶ï¸';
            }
            renderAudioList();
        }
        
        // åœæ­¢æ’­æ”¾
        function stopAudio() {
            if (audioPlayer) {
                audioPlayer.pause();
                audioPlayer.currentTime = 0;
                audioPlayer = null;
            }
            currentPlayingFile = null;
            playerBar.classList.remove('active');
            playerProgressBar.style.width = '0%';
            playerCurrentTime.textContent = '00:00';
            mainPlayBtn.textContent = 'â–¶ï¸';
            renderAudioList();
        }
        
        // è·³è½¬æ’­æ”¾ä½ç½®
        function seekAudio(event) {
            if (!audioPlayer) return;
            
            const progressEl = document.getElementById('playerProgress');
            const rect = progressEl.getBoundingClientRect();
            const percent = (event.clientX - rect.left) / rect.width;
            audioPlayer.currentTime = percent * audioPlayer.duration;
        }
        
        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(filename) {
            const link = document.createElement('a');
            link.href = '/api/audio/download/' + encodeURIComponent(filename);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // æ˜¾ç¤ºåˆ é™¤ç¡®è®¤å¼¹çª—
        function showDeleteModal(filename) {
            fileToDelete = filename;
            deleteModalText.textContent = 'ç¡®å®šè¦åˆ é™¤ "' + filename + '" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚';
            deleteModal.classList.add('active');
        }
        
        // å…³é—­åˆ é™¤å¼¹çª—
        function closeDeleteModal() {
            fileToDelete = null;
            deleteModal.classList.remove('active');
        }
        
        // ç¡®è®¤åˆ é™¤
        async function confirmDelete() {
            if (!fileToDelete) return;
            
            try {
                const response = await fetch('/api/audio/delete/' + encodeURIComponent(fileToDelete), {
                    method: 'DELETE'
                });
                const data = await response.json();
                
                if (data.success) {
                    // å¦‚æœæ­£åœ¨æ’­æ”¾è¢«åˆ é™¤çš„æ–‡ä»¶ï¼Œåœæ­¢æ’­æ”¾
                    if (currentPlayingFile === fileToDelete) {
                        stopAudio();
                    }
                    // åˆ·æ–°åˆ—è¡¨
                    loadAudioList();
                } else {
                    showError('åˆ é™¤å¤±è´¥: ' + data.error);
                }
            } catch (error) {
                showError('åˆ é™¤å¤±è´¥: ç½‘ç»œé”™è¯¯');
            }
            
            closeDeleteModal();
        }

        // è´¨é‡é¢„è®¾æè¿°
        const qualityDescriptions = {
            low: 'ä½å»¶è¿Ÿæ¨¡å¼ï¼šå»¶è¿Ÿæœ€ä½ï¼Œé€‚åˆå®æ—¶é€šè¯ï¼Œå¯èƒ½æœ‰å¡é¡¿',
            smooth: 'æµç•…æ¨¡å¼ï¼šè¾ƒä½å»¶è¿Ÿï¼Œä¼ è¾“è¾ƒç¨³å®š',
            balanced: 'å¹³è¡¡æ¨¡å¼ï¼šå»¶è¿Ÿå’Œç¨³å®šæ€§çš„æœ€ä½³å¹³è¡¡',
            high: 'ç¨³å®šæ¨¡å¼ï¼šä¼ è¾“æ›´ç¨³å®šï¼Œå»¶è¿Ÿç¨é«˜',
            ultra: 'é«˜ç¨³å®šæ¨¡å¼ï¼šæœ€ç¨³å®šçš„ä¼ è¾“ï¼Œå»¶è¿Ÿè¾ƒé«˜'
        };
        
        // æ ¹æ®è´¨é‡å€¼è®¡ç®—å‚æ•°
        // è´¨é‡è¶Šä½ = å»¶è¿Ÿè¶Šä½ = ç¼“å†²åŒºè¶Šå°
        // è´¨é‡è¶Šé«˜ = å»¶è¿Ÿè¶Šé«˜ = ç¼“å†²åŒºè¶Šå¤§ = ä¼ è¾“è¶Šç¨³å®š
        function calculateAudioParams(quality) {
            // ç¼“å†²åŒºå¤§å°ï¼šè´¨é‡è¶Šä½ï¼Œç¼“å†²åŒºè¶Šå°ï¼ˆå»¶è¿Ÿè¶Šä½ï¼‰
            // è´¨é‡ 1-100 æ˜ å°„åˆ° bufferSize 256-4096
            let bufferSizes = [256, 512, 1024, 2048, 4096];
            let bufferIndex;
            
            if (quality <= 10) {
                bufferIndex = 0; // 256 - æœ€ä½å»¶è¿Ÿ
            } else if (quality <= 30) {
                bufferIndex = 1; // 512
            } else if (quality <= 50) {
                bufferIndex = 2; // 1024
            } else if (quality <= 75) {
                bufferIndex = 3; // 2048
            } else {
                bufferIndex = 4; // 4096 - æœ€é«˜ç¨³å®šæ€§
            }
            
            currentBufferSize = bufferSizes[bufferIndex];
            
            // é‡‡æ ·ç‡å›ºå®šä¸º44100ï¼Œä¸æœåŠ¡å™¨ç«¯åŒ¹é…
            currentSampleRate = 44100;
            
            // è®¡ç®—é¢„è®¡å»¶è¿Ÿ (ms)
            const latency = Math.round((currentBufferSize / currentSampleRate) * 1000);
            
            return {
                bufferSize: currentBufferSize,
                sampleRate: currentSampleRate,
                latency: latency
            };
        }
        
        // æ›´æ–°è´¨é‡æ˜¾ç¤º
        function updateQualityDisplay(quality) {
            currentQuality = quality;
            qualityValue.textContent = quality;
            
            const params = calculateAudioParams(quality);
            bufferSizeEl.textContent = params.bufferSize;
            sampleRateEl.textContent = (params.sampleRate / 1000).toFixed(1) + 'k';
            latencyEl.textContent = '~' + params.latency + 'ms';
            
            // æ›´æ–°æè¿°
            if (quality <= 10) {
                qualityDesc.textContent = qualityDescriptions.low;
            } else if (quality <= 30) {
                qualityDesc.textContent = qualityDescriptions.smooth;
            } else if (quality <= 50) {
                qualityDesc.textContent = qualityDescriptions.balanced;
            } else if (quality <= 75) {
                qualityDesc.textContent = qualityDescriptions.high;
            } else {
                qualityDesc.textContent = qualityDescriptions.ultra;
            }
            
            // æ›´æ–°é¢„è®¾æŒ‰é’®çŠ¶æ€
            presetBtns.forEach(btn => {
                const presetQuality = parseInt(btn.dataset.quality);
                if (presetQuality === quality) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('audioQuality', quality);
        }
        
        // è´¨é‡æ»‘å—äº‹ä»¶
        qualitySlider.addEventListener('input', (e) => {
            const quality = parseInt(e.target.value);
            updateQualityDisplay(quality);
            
            // å¦‚æœæ­£åœ¨å½•éŸ³ï¼Œéœ€è¦é‡å¯ä»¥åº”ç”¨æ–°è®¾ç½®
            if (isRecording) {
                restartRecording();
            }
        });
        
        // é¢„è®¾æŒ‰é’®äº‹ä»¶
        presetBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const quality = parseInt(btn.dataset.quality);
                qualitySlider.value = quality;
                updateQualityDisplay(quality);
                
                if (isRecording) {
                    restartRecording();
                }
            });
        });
        
        // é‡å¯å½•éŸ³
        async function restartRecording() {
            stopRecording();
            await new Promise(resolve => setTimeout(resolve, 100));
            startRecording();
        }
        
        // è¿æ¥åˆ° WebSocket æœåŠ¡å™¨
        function connectSocket() {
            socket = io({
                transports: ['websocket'],
                upgrade: false
            });
            
            socket.on('connect', () => {
                statusEl.textContent = 'å·²è¿æ¥åˆ°ç”µè„‘';
                statusEl.className = 'status connected';
                errorEl.style.display = 'none';
                // å¯ç”¨å½•åˆ¶æŒ‰é’®
                recordButton.disabled = false;
                // è¯·æ±‚å½“å‰å½•åˆ¶çŠ¶æ€
                socket.emit('request_recording_status');
            });
            
            socket.on('disconnect', () => {
                statusEl.textContent = 'ä¸ç”µè„‘æ–­å¼€è¿æ¥';
                statusEl.className = 'status disconnected';
                stopRecording();
                // ç¦ç”¨å½•åˆ¶æŒ‰é’®
                recordButton.disabled = true;
                // é‡ç½®å½•åˆ¶UIçŠ¶æ€
                updateRecordingUI(false);
            });
            
            socket.on('connect_error', (error) => {
                showError('è¿æ¥å¤±è´¥: ' + error.message);
                recordButton.disabled = true;
            });
            
            // ç›‘å¬å½•åˆ¶çŠ¶æ€å˜åŒ–
            socket.on('recording_status', (data) => {
                console.log('æ”¶åˆ°å½•åˆ¶çŠ¶æ€:', data);
                updateRecordingUI(data.is_recording);
            });
        }
        
        // æ›´æ–°å½•åˆ¶UIçŠ¶æ€
        function updateRecordingUI(serverRecording) {
            console.log('æ›´æ–°å½•åˆ¶UIçŠ¶æ€:', serverRecording);
            isServerRecording = serverRecording;
            
            if (serverRecording) {
                // æ­£åœ¨å½•åˆ¶
                recordButton.className = 'record-button stop';
                recordButtonText.textContent = 'åœæ­¢å½•åˆ¶';
                recordButton.querySelector('.icon').textContent = 'â¹';
                recordStatus.textContent = 'å½•åˆ¶ä¸­';
                recordStatus.className = 'record-status recording';
                recordTimer.classList.add('active');
                
                // å¼€å§‹è®¡æ—¶
                if (!recordingStartTime) {
                    recordingStartTime = Date.now();
                }
                startRecordingTimer();
            } else {
                // æœªå½•åˆ¶
                recordButton.className = 'record-button start';
                recordButtonText.textContent = 'å¼€å§‹å½•åˆ¶';
                recordButton.querySelector('.icon').textContent = 'âº';
                recordStatus.textContent = 'æœªå½•åˆ¶';
                recordStatus.className = 'record-status idle';
                recordTimer.classList.remove('active');
                
                // åœæ­¢è®¡æ—¶
                stopRecordingTimer();
            }
        }
        
        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // å¼€å§‹å½•åˆ¶è®¡æ—¶å™¨
        function startRecordingTimer() {
            if (recordingTimerInterval) return;
            
            recordingTimerInterval = setInterval(() => {
                if (recordingStartTime) {
                    const elapsed = (Date.now() - recordingStartTime) / 1000;
                    recordTimer.textContent = formatTime(elapsed);
                }
            }, 1000);
        }
        
        // åœæ­¢å½•åˆ¶è®¡æ—¶å™¨
        function stopRecordingTimer() {
            if (recordingTimerInterval) {
                clearInterval(recordingTimerInterval);
                recordingTimerInterval = null;
            }
            recordingStartTime = null;
            recordTimer.textContent = '00:00';
        }
        
        // å½•åˆ¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        recordButton.addEventListener('click', () => {
            if (!socket || !socket.connected) {
                showError('è¯·å…ˆè¿æ¥åˆ°æœåŠ¡å™¨');
                return;
            }
            
            // å‘é€åˆ‡æ¢å½•åˆ¶çŠ¶æ€è¯·æ±‚
            socket.emit('toggle_recording');
            console.log('å‘é€å½•åˆ¶æ§åˆ¶è¯·æ±‚');
        });
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }
        
        // é‡é‡‡æ ·å‡½æ•° - å°†ä»»æ„é‡‡æ ·ç‡è½¬æ¢ä¸ºç›®æ ‡é‡‡æ ·ç‡
        function resample(inputData, inputSampleRate, outputSampleRate) {
            if (inputSampleRate === outputSampleRate) {
                return inputData;
            }
            
            const ratio = inputSampleRate / outputSampleRate;
            const outputLength = Math.round(inputData.length / ratio);
            const output = new Float32Array(outputLength);
            
            for (let i = 0; i < outputLength; i++) {
                const srcIndex = i * ratio;
                const srcIndexFloor = Math.floor(srcIndex);
                const srcIndexCeil = Math.min(srcIndexFloor + 1, inputData.length - 1);
                const t = srcIndex - srcIndexFloor;
                
                // çº¿æ€§æ’å€¼
                output[i] = inputData[srcIndexFloor] * (1 - t) + inputData[srcIndexCeil] * t;
            }
            
            return output;
        }
        
        // å¼€å§‹å½•éŸ³
        async function startRecording() {
            try {
                const params = calculateAudioParams(currentQuality);
                
                // è¯·æ±‚éº¦å…‹é£æƒé™ - ä¸å¼ºåˆ¶æŒ‡å®šé‡‡æ ·ç‡ï¼Œè®©è®¾å¤‡ä½¿ç”¨é»˜è®¤å€¼
                mediaStream = await navigator.mediaDevices.getUserMedia({
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true,
                        channelCount: 1
                    }
                });
                
                // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡ - ä¸æŒ‡å®šé‡‡æ ·ç‡ï¼Œä½¿ç”¨è®¾å¤‡é»˜è®¤å€¼
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // è·å–å®é™…é‡‡æ ·ç‡
                const actualSampleRate = audioContext.sampleRate;
                console.log('è®¾å¤‡å®é™…é‡‡æ ·ç‡:', actualSampleRate, 'ç›®æ ‡é‡‡æ ·ç‡:', 44100);
                
                const source = audioContext.createMediaStreamSource(mediaStream);
                
                // åˆ›å»ºåˆ†æå™¨ç”¨äºéŸ³é‡æ˜¾ç¤º
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                source.connect(analyser);
                
                // åˆ›å»ºéŸ³é¢‘å¤„ç†å™¨ - ä½¿ç”¨å½“å‰è´¨é‡å¯¹åº”çš„ç¼“å†²åŒºå¤§å°
                scriptProcessor = audioContext.createScriptProcessor(params.bufferSize, 1, 1);
                source.connect(scriptProcessor);
                scriptProcessor.connect(audioContext.destination);
                
                // å¤„ç†éŸ³é¢‘æ•°æ®
                scriptProcessor.onaudioprocess = (e) => {
                    if (!isRecording) return;
                    
                    let inputData = e.inputBuffer.getChannelData(0);
                    
                    // å¦‚æœé‡‡æ ·ç‡ä¸åŒ¹é…ï¼Œè¿›è¡Œé‡é‡‡æ ·
                    if (actualSampleRate !== 44100) {
                        inputData = resample(inputData, actualSampleRate, 44100);
                    }
                    
                    // è½¬æ¢ä¸º Int16 æ ¼å¼
                    const int16Data = new Int16Array(inputData.length);
                    for (let i = 0; i < inputData.length; i++) {
                        const s = Math.max(-1, Math.min(1, inputData[i]));
                        int16Data[i] = s < 0 ? s * 0x8000 : s * 0x7FFF;
                    }
                    
                    // å‘é€åˆ°æœåŠ¡å™¨
                    socket.emit('audio_data', int16Data.buffer);
                };
                
                // æ›´æ–°éŸ³é‡æ˜¾ç¤º
                updateVolume();
                
                isRecording = true;
                micButton.classList.add('recording');
                statusEl.textContent = 'æ­£åœ¨å½•éŸ³...';
                statusEl.className = 'status recording';
                
            } catch (error) {
                showError('æ— æ³•è®¿é—®éº¦å…‹é£: ' + error.message);
                console.error('éº¦å…‹é£è®¿é—®é”™è¯¯:', error);
            }
        }
        
        // åœæ­¢å½•éŸ³
        function stopRecording() {
            isRecording = false;
            
            if (scriptProcessor) {
                scriptProcessor.disconnect();
                scriptProcessor = null;
            }
            
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
            }
            
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
            
            micButton.classList.remove('recording');
            if (socket && socket.connected) {
                statusEl.textContent = 'å·²è¿æ¥åˆ°ç”µè„‘';
                statusEl.className = 'status connected';
            }
            volumeBar.style.width = '0%';
        }
        
        // æ›´æ–°éŸ³é‡æ˜¾ç¤º
        function updateVolume() {
            if (!isRecording || !analyser) return;
            
            const dataArray = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(dataArray);
            
            const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
            const volume = Math.min(100, (average / 255) * 100 * 2);
            volumeBar.style.width = volume + '%';
            
            requestAnimationFrame(updateVolume);
        }
        
        // éº¦å…‹é£æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        micButton.addEventListener('click', () => {
            if (!socket || !socket.connected) {
                showError('è¯·å…ˆè¿æ¥åˆ°æœåŠ¡å™¨');
                return;
            }
            
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        });
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        function init() {
            // æ¸…é™¤å¯èƒ½å¯¼è‡´é—®é¢˜çš„æ—§è®¾ç½®
            const pageVersion = 'v2';
            if (localStorage.getItem('pageVersion') !== pageVersion) {
                localStorage.removeItem('audioQuality');
                localStorage.setItem('pageVersion', pageVersion);
                console.log('å·²æ¸…é™¤æ—§ç‰ˆæœ¬è®¾ç½®');
            }
            
            // ä»æœ¬åœ°å­˜å‚¨è¯»å–è´¨é‡è®¾ç½®
            const savedQuality = localStorage.getItem('audioQuality');
            if (savedQuality) {
                currentQuality = parseInt(savedQuality);
                qualitySlider.value = currentQuality;
            }
            updateQualityDisplay(currentQuality);
            
            // è¿æ¥æœåŠ¡å™¨
            connectSocket();
        }
        
        init();
        
        // é¡µé¢å¸è½½æ—¶æ¸…ç†
        window.addEventListener('beforeunload', () => {
            stopRecording();
            if (socket) socket.disconnect();
        });
    </script>
</body>
</html>
